<?xml version="1.0"?>
<rss version="2.0">

  <channel>
    <title>ploeh blog</title>
    <link>https://blog.ploeh.dk</link>
    <description>danish software design</description>
    <language>en-us</language>
    <copyright>Mark Seemann</copyright>
    <pubDate>Mon, 17 Nov 2025 08:39:07 UTC</pubDate>
    <lastBuildDate>Mon, 17 Nov 2025 08:39:07 UTC</lastBuildDate>

    
      <item>
        <title>Empirical software prototyping</title>
        <link>https://blog.ploeh.dk/2025/11/17/empirical-software-prototyping/</link>
        <pubDate>Mon, 17 Nov 2025 08:38:00 UTC</pubDate>
        <description>


&lt;div id=&quot;post&quot;&gt;
    &lt;p&gt;
        &lt;em&gt;How do you add tests to a proof-of-concept? Should you?&lt;/em&gt;
    &lt;/p&gt;
    &lt;p&gt;
        This is the second article in a small series on &lt;a href=&quot;/2025/10/27/empirical-test-after-development&quot;&gt;empirical test-after development&lt;/a&gt;. I&apos;ll try to answer an occasionally-asked question: Should one use test-driven development (TDD) for prototyping?
    &lt;/p&gt;
    &lt;p&gt;
        There are variations on this question, but it tends to come up when discussing TDD. Some &lt;a href=&quot;https://x.com/hillelogram/status/1445435617047990273&quot;&gt;software thought leaders&lt;/a&gt; proclaim that you should always take advantage of TDD when writing code. The short response is that there are exceptions to that rule. Those thought leaders know that, too, but they choose to communicate the way that they do in order to make a point. I don&apos;t blame them, and I use a similar style of communication from time to time. If you hedge every sentence you utter with qualifications, the message often disappears in unclear language. Thus, when someone admonishes that you should always follow TDD, what they really mean (I suppose; I&apos;m not a telepath) is that you should predominantly use TDD. More than 80% of the time.
    &lt;/p&gt;
    &lt;p&gt;
        This is a common teaching tool. A competent teacher takes into account the skill level of a student. A new learner has to start with the basics before advanced topics. Early in the learning process, there&apos;s no room for sophistication. Even when a teacher understands that there are exceptions, he or she starts with a general rule, like &apos;you should always do TDD&apos;.
    &lt;/p&gt;
    &lt;p&gt;
        While this may seem like a digression, this detour answers most of the questions related to software prototyping. People find it difficult to apply TDD when developing a prototype. I do, too. So don&apos;t.
    &lt;/p&gt;
    &lt;h3 id=&quot;873f1d7273e94b7eb9028fde1d75d890&quot;&gt;
        Prototyping or proof-of-concept? &lt;a href=&quot;#873f1d7273e94b7eb9028fde1d75d890&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        I&apos;ve already committed the sin of using &lt;em&gt;prototype&lt;/em&gt; and &lt;em&gt;proof-of-concept&lt;/em&gt; interchangeably. This only reflects how I use these terms in conversation. While I&apos;m aware that the internet offers articles to help me distinguish, I find the differences too subtle to be of use when communicating with other people. Even if I learn the fine details that separate one from the other, I can&apos;t be sure that the person I&apos;m talking to shares that understanding.
    &lt;/p&gt;
    &lt;p&gt;
        Since &lt;em&gt;prototype&lt;/em&gt; is easier to say, I tend to use that term more than &lt;em&gt;proof-of-concept&lt;/em&gt;. In any case, a prototype in this context is an exploration of an idea. You surmise that it&apos;s possible to do something in a certain way, but you&apos;re not sure. Before committing to the uncertain idea, you develop an isolated code base to vet the concept.
    &lt;/p&gt;
    &lt;p&gt;
        This could be an idea for an algorithm, use of a new technology such as a framework or reusable library, a different cloud platform, or even a new programming language.
    &lt;/p&gt;
    &lt;p&gt;
        Such exploration is already challenging in itself. How is the API of the library structured? Should you call &lt;code&gt;IsFooble&lt;/code&gt; or &lt;code&gt;HasFooble&lt;/code&gt; here? How do you write a &lt;code&gt;for&lt;/code&gt; loop in &lt;a href=&quot;https://en.wikipedia.org/wiki/APL_(programming_language)&quot;&gt;APL&lt;/a&gt;? How does one even compile a &lt;a href=&quot;https://www.java.com&quot;&gt;Java&lt;/a&gt; program? How do you programmatically provision new resources in &lt;a href=&quot;https://learn.microsoft.com/en-us/fabric/fundamentals/microsoft-fabric-overview&quot;&gt;Microsoft Fabric&lt;/a&gt;? How do you convert a &lt;a href=&quot;https://en.wikipedia.org/wiki/JPEG&quot;&gt;JPG&lt;/a&gt; file to &lt;a href=&quot;https://en.wikipedia.org/wiki/PDF&quot;&gt;PDF&lt;/a&gt; on the server?
    &lt;/p&gt;
    &lt;p&gt;
        There are plenty of questions like these where you don&apos;t even know the shape of things. The point of the exercise is often to figure those things out. When you don&apos;t know how APIs are organized, or which technologies are available to you, writing tests first is difficult. No wonder people sometimes ask me about this.
    &lt;/p&gt;
    &lt;h3 id=&quot;33bc345c3bb34ca795532ab0b13e4f19&quot;&gt;
        Code to throw away &lt;a href=&quot;#33bc345c3bb34ca795532ab0b13e4f19&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        The very nature of a prototype is that it&apos;s an experiment designed to explore an idea. The safest way to engage with a prototype is to create an isolated code base for that particular purpose. A prototype is not an &lt;a href=&quot;https://en.wikipedia.org/wiki/Minimum_viable_product&quot;&gt;MVP&lt;/a&gt; or an early version of the product. It is a deliberately unstructured exploration of what&apos;s possible. The entire purpose of a prototype is to &lt;em&gt;learn&lt;/em&gt;. Often the exploration process is time-boxed.
    &lt;/p&gt;
    &lt;p&gt;
        If the prototype turns out to be successful, you may proceed to implement the idea in your production code base. Even if you didn&apos;t use TDD for the prototype, you should now have learned enough that you can apply TDD for the production implementation.
    &lt;/p&gt;
    &lt;p&gt;
        The most common obstacle to this chain of events, I understand, is that &apos;bosses&apos; demand that a successful prototype be put into production. Try to resist such demands. It often helps planning for this from the outset. If you can, do the prototype in a way that effectively prevents such predictable demands. If you&apos;re exploring the viability of a new algorithm, write it in an alternative programming language. For example, I&apos;ve written prototypes in &lt;a href=&quot;https://www.haskell.org/&quot;&gt;Haskell&lt;/a&gt;, which very effectively prevents demands that the code be put into production.
    &lt;/p&gt;
    &lt;p&gt;
        If your organization is a little behind the cutting edge, you can also write the prototype in a newer version of your language or run-time. Use functional programming if you normally use object-oriented design. Or you may pick an auxiliary technology incompatible with how you normally do things: Use the &apos;wrong&apos; JSON serializer library, an in-memory database, write a command-line program if you need a GUI, or vice versa.
    &lt;/p&gt;
    &lt;p&gt;
        You&apos;re the technical expert. &lt;a href=&quot;/2019/03/18/the-programmer-as-decision-maker&quot;&gt;Make technical decisions&lt;/a&gt;. Surely, you can come up with something that sounds convincing enough to a non-technical stakeholder to prevent putting the prototype into production.
    &lt;/p&gt;
    &lt;p&gt;
        To be sure we&apos;re on firm moral ground here: I&apos;m not advocating that you should be dishonest, or work against the interests of your organization. Rather, I suggest that you act politically. Understand what motivates other people. Non-technical stakeholders usually don&apos;t have the insight to understand why a successful prototype shouldn&apos;t be promoted to production code. Unfortunately, they often view programmers as typists, and with that view, it seems wasteful to repeat the work of typing in the prototype code. &lt;a href=&quot;/2018/09/17/typing-is-not-a-programming-bottleneck&quot;&gt;Typing, however, is not a bottleneck&lt;/a&gt;, but it can be hard to convince other people of this.
    &lt;/p&gt;
    &lt;p&gt;
        If all else fails, and you&apos;re forced to promote the prototype to production code, you now have a piece of legacy code on hand, in which case the techniques outlined in &lt;a href=&quot;/2025/11/03/empirical-characterization-testing&quot;&gt;the previous article&lt;/a&gt; should prove useful.
    &lt;/p&gt;
    &lt;h3 id=&quot;92448892cad9447dab00ef4e1e82bcff&quot;&gt;
        Prototyping in existing code bases &lt;a href=&quot;#92448892cad9447dab00ef4e1e82bcff&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        A special case occurs when you need to do a prototype in an existing code base. You already have a big, complicated system, and you would like to explore whether a particular idea is applicable in that context. Perhaps data access is currently too slow, and you have an idea of how to speed things up, for example by &lt;a href=&quot;/2022/02/14/a-conditional-sandwich-example&quot;&gt;speculative prefetching&lt;/a&gt;. When the problem is one of performance, you&apos;ll need to &lt;a href=&quot;https://ericlippert.com/2012/12/17/performance-rant/&quot;&gt;measure&lt;/a&gt; in a realistic environment. This may prevent you from creating an isolated prototype code base.
    &lt;/p&gt;
    &lt;p&gt;
        In such cases, use Git to your advantage. Make a new prototype branch and work there. You may deliberately choose to make it a long-lived &lt;a href=&quot;https://martinfowler.com/bliki/FeatureBranch.html&quot;&gt;feature branch&lt;/a&gt;. Once the prototype is done, the code may now be so out of sync with &lt;em&gt;master&lt;/em&gt; that &apos;merge conflicts&apos; sounds like a plausible excuse to a non-technical stakeholder. As above, be political.
    &lt;/p&gt;
    &lt;p&gt;
        In any case, don&apos;t merge the prototype branch, even if you could. Instead, use the knowledge gained during the prototype work to re-implement the new idea, this time using empirical software engineering techniques like TDD.
    &lt;/p&gt;
    &lt;h3 id=&quot;1533c57419f64e149a4aec070eb8f714&quot;&gt;
        Conclusion &lt;a href=&quot;#1533c57419f64e149a4aec070eb8f714&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        Prototyping is usually antithetical to TDD. On the other hand, TDD is an effective empirical method for software development. Without it, you have to seek other answers to the question: How do we know that this works?
    &lt;/p&gt;
    &lt;p&gt;
        Due to the explorative nature of prototyping, testing of the prototype tends to be explorative as well. Start up the prototype, poke at it, see if it behaves as expected. While you do gain a limited amount of empirical knowledge from such a process, it&apos;s unsystematic and non-repeatable, so little &lt;em&gt;corroboration&lt;/em&gt; of hypothesis takes place. Therefore, once the prototype work is done, it&apos;s important to proceed on firmer footing if the prototype was successful.
    &lt;/p&gt;
    &lt;p&gt;
        The safest way is to put the prototype to the side, but use the knowledge to test-drive the production version of the idea. This may require a bit of political manoeuvring. If that fails, and you&apos;re forced to promote the prototype to production use, you may use the techniques for adding &lt;a href=&quot;/2025/11/03/empirical-characterization-testing&quot;&gt;empirical Characterization Tests&lt;/a&gt;.
    &lt;/p&gt;
&lt;/div&gt;&lt;hr&gt;
      This blog is totally free, but if you like it, please consider &lt;a href="https://blog.ploeh.dk/support"&gt;supporting it&lt;/a&gt;.</description>
        <author>Mark Seemann</author>
        <guid isPermaLink="false">https://blog.ploeh.dk/2025/11/17/empirical-software-prototyping</guid>
      </item>
    
      <item>
        <title>100% coverage is not that trivial</title>
        <link>https://blog.ploeh.dk/2025/11/10/100-coverage-is-not-that-trivial/</link>
        <pubDate>Mon, 10 Nov 2025 12:00:00 UTC</pubDate>
        <description>


&lt;div id=&quot;post&quot;&gt;
    &lt;p&gt;
        &lt;em&gt;Dispelling a myth I helped propagate.&lt;/em&gt;
    &lt;/p&gt;
    &lt;p&gt;
        Most people who have been around automated testing for a few years understand that &lt;a href=&quot;/2015/11/16/code-coverage-is-a-useless-target-measure&quot;&gt;code coverage is a useless target measure&lt;/a&gt;. Unfortunately, through a game of Chinese whispers, this message often degenerates to the simpler, but incorrect, notion that code coverage is useless.
    &lt;/p&gt;
    &lt;p&gt;
        As I&apos;ve already covered in that article, code coverage may be useful for other reasons. That&apos;s not my agenda for this article. Rather, something about this discussion have been bothering me for a long time.
    &lt;/p&gt;
    &lt;p&gt;
        Have you ever had an uneasy feeling about a topic, without being able to put your finger on exactly what the problem is? This happens to me regularly. I&apos;m going along with the accepted narrative until the cognitive dissonance becomes so conspicuous that I can no longer ignore it.
    &lt;/p&gt;
    &lt;p&gt;
        In this article, I&apos;ll grapple with the notion that &apos;reaching 100% code coverage is easy.&apos;
    &lt;/p&gt;
    &lt;h3 id=&quot;1e210ae46a1b45d4a3764694d9128fc7&quot;&gt;
        Origins &lt;a href=&quot;#1e210ae46a1b45d4a3764694d9128fc7&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        This tends to come up when discussing code coverage. People will say that 100% code coverage isn&apos;t a useful measure, because it&apos;s easy to reach 100%. I have &lt;a href=&quot;/2015/11/16/code-coverage-is-a-useless-target-measure&quot;&gt;used that argument myself&lt;/a&gt;. Fortunately I also cited my influences in 2015; in this case Martin Fowler&apos;s &lt;a href=&quot;https://martinfowler.com/bliki/AssertionFreeTesting.html&quot;&gt;Assertion Free Testing&lt;/a&gt;.
    &lt;/p&gt;
    &lt;blockquote&gt;
        &lt;p&gt;
            &quot;[...] of course you can do this and have 100% code coverage - which is one reason why you have to be careful on interpreting code coverage data.&quot;
        &lt;/p&gt;
        &lt;footer&gt;&lt;a href=&quot;https://martinfowler.com/bliki/AssertionFreeTesting.html&quot;&gt;Assertion Free Testing&lt;/a&gt;, Martin Fowler, 2004&lt;/footer&gt;
    &lt;/blockquote&gt;
    &lt;p&gt;
        This may not be the only source of such a claim, but it may have been a contributing factor. There&apos;s little wrong with Fowler&apos;s article, which doesn&apos;t make any groundless claims, but I can imagine how &lt;a href=&quot;https://martinfowler.com/bliki/SemanticDiffusion.html&quot;&gt;semantic diffusion&lt;/a&gt; works on an idea like that.
    &lt;/p&gt;
    &lt;p&gt;
        Fowler also wrote that it&apos;s &quot;a story from a friend of a friend.&quot; When the source of a story is twice-removed like that, alarm bells should go off. This is the stuff that urban legends are made of, and I wonder if this isn&apos;t rather an example of &apos;programmer folk wisdom&apos;. I&apos;ve heard variations of that story many times over the years, from various people.
    &lt;/p&gt;
    &lt;h3 id=&quot;b6de8ca704e0437dadc73f58c0fe84fa&quot;&gt;
        It&apos;s not that easy &lt;a href=&quot;#b6de8ca704e0437dadc73f58c0fe84fa&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        Even though I&apos;ve helped promulgate the idea that reaching 100% code coverage is easy if you cheat, I now realise that that&apos;s an overstatement. Even if you write no assertions, and surround the test code with a &lt;code&gt;try/catch&lt;/code&gt; block, you can&apos;t trivially reach 100% coverage. There are going to be branches that you can&apos;t reach.
    &lt;/p&gt;
    &lt;p&gt;
        This often happens in real code bases that query databases, call web services, and so on. If a branch depends on &lt;a href=&quot;http://xunitpatterns.com/indirect%20input.html&quot;&gt;indirect input&lt;/a&gt;, you can&apos;t force execution down that path just by suppressing exceptions.
    &lt;/p&gt;
    &lt;p&gt;
        An example is warranted.
    &lt;/p&gt;
    &lt;h3 id=&quot;11319fa843404ea193e56cc614603975&quot;&gt;
        Example &lt;a href=&quot;#11319fa843404ea193e56cc614603975&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        Consider this &lt;code&gt;ReadReservation&lt;/code&gt; method in the &lt;code&gt;SqlReservationsRepository&lt;/code&gt; class from the code base that accompanies my book &lt;a href=&quot;/2021/06/14/new-book-code-that-fits-in-your-head&quot;&gt;Code That Fits in Your Head&lt;/a&gt;:
    &lt;/p&gt;
    &lt;p&gt;
        &lt;pre&gt;&lt;span style=&quot;color:blue;&quot;&gt;public&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;async&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Task&lt;/span&gt;&amp;lt;&lt;span style=&quot;color:#2b91af;&quot;&gt;Reservation&lt;/span&gt;?&amp;gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;ReadReservation&lt;/span&gt;(&lt;span style=&quot;color:blue;&quot;&gt;int&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;restaurantId&lt;/span&gt;,&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Guid&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;id&lt;/span&gt;)
{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;string&lt;/span&gt;&amp;nbsp;readByIdSql&amp;nbsp;=&amp;nbsp;&lt;span style=&quot;color:maroon;&quot;&gt;@&amp;quot;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;SELECT&amp;nbsp;[PublicId],&amp;nbsp;[At],&amp;nbsp;[Name],&amp;nbsp;[Email],&amp;nbsp;[Quantity]
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;FROM&amp;nbsp;[dbo].[Reservations]
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;WHERE&amp;nbsp;[PublicId]&amp;nbsp;=&amp;nbsp;@id&amp;quot;&lt;/span&gt;;
 
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;using&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;var&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;conn&lt;/span&gt;&amp;nbsp;=&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;new&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;SqlConnection&lt;/span&gt;(ConnectionString);
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;using&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;var&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;cmd&lt;/span&gt;&amp;nbsp;=&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;new&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;SqlCommand&lt;/span&gt;(readByIdSql,&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;conn&lt;/span&gt;);
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;cmd&lt;/span&gt;.Parameters.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;AddWithValue&lt;/span&gt;(&lt;span style=&quot;color:#a31515;&quot;&gt;&amp;quot;@id&amp;quot;&lt;/span&gt;,&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;id&lt;/span&gt;);
 
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;await&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;conn&lt;/span&gt;.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;OpenAsync&lt;/span&gt;().&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;ConfigureAwait&lt;/span&gt;(&lt;span style=&quot;color:blue;&quot;&gt;false&lt;/span&gt;);
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;using&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;var&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;rdr&lt;/span&gt;&amp;nbsp;=&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;await&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;cmd&lt;/span&gt;.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;ExecuteReaderAsync&lt;/span&gt;().&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;ConfigureAwait&lt;/span&gt;(&lt;span style=&quot;color:blue;&quot;&gt;false&lt;/span&gt;);
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;if&lt;/span&gt;&amp;nbsp;(!&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;rdr&lt;/span&gt;.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;Read&lt;/span&gt;())
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;return&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;null&lt;/span&gt;;
 
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;return&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#74531f;&quot;&gt;ReadReservationRow&lt;/span&gt;(&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;rdr&lt;/span&gt;);
}&lt;/pre&gt;
    &lt;/p&gt;
    &lt;p&gt;
        Even though it only has a &lt;a href=&quot;https://en.wikipedia.org/wiki/Cyclomatic_complexity&quot;&gt;cyclomatic complexity&lt;/a&gt; of 2, most of it is unreachable to a test that tries to avoid hard work.
    &lt;/p&gt;
    &lt;p&gt;
        You can try to cheat in the suggested way by adding a test like this:
    &lt;/p&gt;
    &lt;p&gt;
        &lt;pre&gt;[&lt;span style=&quot;color:#2b91af;&quot;&gt;Fact&lt;/span&gt;]
&lt;span style=&quot;color:blue;&quot;&gt;public&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;async&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Task&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;ReadReservation&lt;/span&gt;()
{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;try&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;var&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;sut&lt;/span&gt;&amp;nbsp;=&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;new&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;SqlReservationsRepository&lt;/span&gt;(&lt;span style=&quot;color:#a31515;&quot;&gt;&amp;quot;dunno&amp;quot;&lt;/span&gt;);
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;var&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;actual&lt;/span&gt;&amp;nbsp;=&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;await&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;sut&lt;/span&gt;.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;ReadReservation&lt;/span&gt;(0,&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Guid&lt;/span&gt;.&lt;span style=&quot;color:#74531f;&quot;&gt;NewGuid&lt;/span&gt;());
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;catch&lt;/span&gt;&amp;nbsp;{&amp;nbsp;}
}&lt;/pre&gt;
    &lt;/p&gt;
    &lt;p&gt;
        Granted, this test passes, and if you had 0% code coverage before, it does improve the metric slightly. Interestingly, the &lt;a href=&quot;https://learn.microsoft.com/en-us/dotnet/core/testing/unit-testing-code-coverage&quot;&gt;Coverlet collector for .NET&lt;/a&gt; reports that only the first line, which creates the &lt;code&gt;conn&lt;/code&gt; variable, is covered. I wonder, though, if this is due to some kind of compiler optimization associated with asynchronous execution that the coverage tool fails to capture.
    &lt;/p&gt;
    &lt;p&gt;
        More understandably, execution reaches &lt;code&gt;conn.OpenAsync()&lt;/code&gt; and crashes, since the test hasn&apos;t provided a connection to a real database. This is what happens if you run the test without the surrounding &lt;code&gt;try/catch&lt;/code&gt; block.
    &lt;/p&gt;
    &lt;p&gt;
        Coverlet reports 18% coverage, and that&apos;s as high you can get with &apos;the easy hack&apos;. 100% is some distance away.
    &lt;/p&gt;
    &lt;h3 id=&quot;c6e5475f8257495f9c93e4b69e08f761&quot;&gt;
        Toward better coverage &lt;a href=&quot;#c6e5475f8257495f9c93e4b69e08f761&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        You may protest that we can do better than this. After all, with utter disregard for using proper arguments, I passed &lt;code&gt;&quot;dunno&quot;&lt;/code&gt; as a connection string. Clearly that doesn&apos;t work.
    &lt;/p&gt;
    &lt;p&gt;
        Couldn&apos;t we easily get to 100% by providing a proper connection string? Perhaps, but what&apos;s a proper connection string?
    &lt;/p&gt;
    &lt;p&gt;
        It doesn&apos;t help if you pass a well-formed connection string instead of &lt;code&gt;&quot;dunno&quot;&lt;/code&gt;. In fact, it will only slow down the test, because then &lt;code&gt;conn.OpenAsync()&lt;/code&gt; will attempt to open the connection. If the database is unreachable, that statement will eventually time out and fail with an exception.
    &lt;/p&gt;
    &lt;p&gt;
        Couldn&apos;t you, though, give it a connection string to a real database?
    &lt;/p&gt;
    &lt;p&gt;
        Yes, you could. If you do that, though, you should make sure that the database has a schema compatible with &lt;code&gt;readByIdSql&lt;/code&gt;. Otherwise, the query will fail. What happens if the implied schema changes? Now you need to make sure that the database is updated, too. This sounds error-prone. Perhaps you should automate that.
    &lt;/p&gt;
    &lt;p&gt;
        Furthermore, you may easily cover the branch that returns &lt;code&gt;null&lt;/code&gt;. After all, when you query for &lt;code&gt;Guid.NewGuid()&lt;/code&gt;, that value is not going to be in the table. On the other hand, how will you cover the other branch; the one that returns a row?
    &lt;/p&gt;
    &lt;p&gt;
        You can only do that if you know the ID of a value already in that table. You may write a second test that queries for that known value. Now you have 100% coverage.
    &lt;/p&gt;
    &lt;p&gt;
        What you have done at this point, however, is no longer an easy cheat to get to 100%. You have, essentially, added integration tests of the data access subsystem.
    &lt;/p&gt;
    &lt;p&gt;
        How about adding some assertions to make the tests useful?
    &lt;/p&gt;
    &lt;h3 id=&quot;5286d5b5be734102b73c181d8df7dbaf&quot;&gt;
        Integration tests for 100% &lt;a href=&quot;#5286d5b5be734102b73c181d8df7dbaf&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        In most systems, you will at least need some integration tests to reach 100% code coverage. While the code shown in &lt;a href=&quot;/code-that-fits-in-your-head&quot;&gt;Code That Fits in Your Head&lt;/a&gt; doesn&apos;t have 100% code coverage (that was never my goal), it looks quite good. (It&apos;s hard to get a single number, because Coverlet apparently can&apos;t measure coverage by running multiple test projects, so I can only get partial results. Coverage is probably better than 80%, I estimate.)
    &lt;/p&gt;
    &lt;p&gt;
        To test &lt;code&gt;ReadReservation&lt;/code&gt; I wrote integration tests that automate setup and tear-down of a local test-specific database. The book, and the Git repository that accompanies it, has all the details.
    &lt;/p&gt;
    &lt;p&gt;
        Getting to 100%, or even 80%, requires dedicated work. In a realistic code base, the claim that reaching 100% is trivial is hardly true.
    &lt;/p&gt;
    &lt;h3 id=&quot;5c0e004b31bb42208054e1e95f01b29d&quot;&gt;
        Conclusion &lt;a href=&quot;#5c0e004b31bb42208054e1e95f01b29d&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        Programmer folk wisdom &apos;knows&apos; that code coverage is useless. One argument is that any fool can reach 100% by writing assertion-free tests surrounded by &lt;code&gt;try/catch&lt;/code&gt; blocks.
    &lt;/p&gt;
    &lt;p&gt;
        This is hardly true in most significant code bases. Whenever you deal with indirect input, &lt;code&gt;try/catch&lt;/code&gt; is insufficient to control whereto execution branches.
    &lt;/p&gt;
    &lt;p&gt;
        This suggests that high code-coverage numbers are good, and low numbers bad. &lt;a href=&quot;/2018/11/12/what-to-test-and-not-to-test&quot;&gt;What constitutes high and low is context-dependent&lt;/a&gt;. What seems to remain true, however, is that code coverage is a useless target. This has little to do with how trivial it is to reach 100%, but rather everything to do with how humans respond to incentives.
    &lt;/p&gt;
&lt;/div&gt;&lt;hr&gt;
      This blog is totally free, but if you like it, please consider &lt;a href="https://blog.ploeh.dk/support"&gt;supporting it&lt;/a&gt;.</description>
        <author>Mark Seemann</author>
        <guid isPermaLink="false">https://blog.ploeh.dk/2025/11/10/100-coverage-is-not-that-trivial</guid>
      </item>
    
      <item>
        <title>Empirical Characterization Testing</title>
        <link>https://blog.ploeh.dk/2025/11/03/empirical-characterization-testing/</link>
        <pubDate>Mon, 03 Nov 2025 13:08:00 UTC</pubDate>
        <description>


&lt;div id=&quot;post&quot;&gt;
    &lt;p&gt;
        &lt;em&gt;Gathering empirical evidence while adding tests to legacy code.&lt;/em&gt;
    &lt;/p&gt;
    &lt;p&gt;
        This article is part of a short series on &lt;a href=&quot;/2025/10/27/empirical-test-after-development&quot;&gt;empirical test-after techniques&lt;/a&gt;. Sometimes, test-driven development (TDD) is impractical. This often happens when faced with legacy code. Although there&apos;s a dearth of hard data, I guess that most code in the world falls into this category. Other &lt;a href=&quot;https://x.com/hillelogram/status/1445435617047990273&quot;&gt;software thought leaders&lt;/a&gt; seem to suggest the same notion.
    &lt;/p&gt;
    &lt;p&gt;
        For the purposes of this discussion, the definition of &lt;em&gt;legacy code&lt;/em&gt; is code without automated tests.
    &lt;/p&gt;
    &lt;blockquote&gt;
        &lt;p&gt;
            &quot;Code without tests is bad code. It doesn&apos;t matter how well written it is; it doesn&apos;t matter how pretty or object-oriented or well-encapsulated it is. With tests, we can change the behavior of our code quickly and verifiably. Without them, we really don&apos;t know if our code is getting better or worse.&quot;
        &lt;/p&gt;
        &lt;footer&gt;&lt;a href=&quot;/ref/wewlc&quot;&gt;Working Effectively with Legacy Code&lt;/a&gt;, preface, Michael C. Feathers, Prentice Hall, 2005&lt;/footer&gt;
    &lt;/blockquote&gt;
    &lt;p&gt;
        As Michael Feathers suggest, the accumulation of knowledge is at the root of this definition. As I outlined in &lt;a href=&quot;/2025/10/20/epistemology-of-software&quot;&gt;Epistemology of software&lt;/a&gt;, tests are the source of empirical evidence. In principle it&apos;s possible to apply a rigorous testing regimen with manual testing, but in most cases this is (also) impractical for reasons that are different from the barriers to automated testing. In the rest of this article, I&apos;ll exclusively discuss automated testing.
    &lt;/p&gt;
    &lt;p&gt;
        We may reasonably extend the definition of legacy code to a code base without adequate testing support.
    &lt;/p&gt;
    &lt;h3 id=&quot;53c15894a2b14adcb0f6f2476fedbd52&quot;&gt;
        When do we have enough tests? &lt;a href=&quot;#53c15894a2b14adcb0f6f2476fedbd52&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        What, exactly, is &lt;em&gt;adequate testing support?&lt;/em&gt; The answer is the same as in science, overall. When do you have enough scientific evidence that a particular theory is widely accepted? There&apos;s no universal answer to that, and no, &lt;a href=&quot;https://xkcd.com/882/&quot;&gt;p-values less than 0.05 isn&apos;t the answer, either&lt;/a&gt;.
    &lt;/p&gt;
    &lt;p&gt;
        In short, adequate empirical evidence is when a hypothesis is sufficiently corroborated to be accepted. Keep in mind that science can never prove a theory correct, but performing experiments against &lt;a href=&quot;https://en.wikipedia.org/wiki/Falsifiability&quot;&gt;falsifiable&lt;/a&gt; predictions can disprove it. This applies to software, too.
    &lt;/p&gt;
    &lt;blockquote&gt;
        &lt;p&gt;
            &quot;Testing shows the presence, not the absence of bugs.&quot;
        &lt;/p&gt;
        &lt;footer&gt;&lt;cite&gt;Software Engineering Techniques, April 1970. Report on a conference sponsored by the NATO Science Committee&lt;/cite&gt;, Edsger W. Dijkstra, Rome, Italy, 1969.&lt;/footer&gt;
    &lt;/blockquote&gt;
    &lt;p&gt;
        The terminology of hypothesis, corroboration, etc. may be opaque to many software developers. Here&apos;s what it means in terms of software engineering: You have unspoken and implicit hypotheses about the code you&apos;re writing. Usually, once you&apos;re done with a task, your hypothesis is that the code makes the software work as intended. Anyone who&apos;s written more than a &lt;a href=&quot;https://en.wikipedia.org/wiki/%22Hello,_World!%22_program&quot;&gt;hello-world program&lt;/a&gt; knows, however, that believing the code to be correct is not enough. How many times have you written code that you assumed correct, only to find that it was not?
    &lt;/p&gt;
    &lt;p&gt;
        That&apos;s the lack of knowledge that testing attempts to address. Even manual testing. A test is an experiment that produces empirical evidence. As Dijkstra quipped, passing tests don&apos;t prove the software correct, but the more passing tests we have, the more confidence we gain. &lt;a href=&quot;/2018/11/12/what-to-test-and-not-to-test&quot;&gt;At some point&lt;/a&gt;, the passing tests provide enough confidence that you and other stakeholders consider it sensible to release or deploy the software. We say that the failure to find failing tests corroborates our hypothesis that the software works as intended.
    &lt;/p&gt;
    &lt;p&gt;
        In the context of legacy code, it&apos;s not the absolute lack of automated tests that characterizes legacy code. Rather, it&apos;s the lack of adequate test coverage. It&apos;s that you don&apos;t have enough tests. Thus, when working with legacy code, you want to add tests after the fact.
    &lt;/p&gt;
    &lt;h3 id=&quot;beab7a226a9148ac84147bf5f7cc941a&quot;&gt;
        Characterization Test recipes &lt;a href=&quot;#beab7a226a9148ac84147bf5f7cc941a&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        A test written after the fact against a legacy code base is called a Characterization Test, because it characterizes (i.e. describes) the behaviour of the system under test (SUT) at the time it was written. It&apos;s not a given that this behaviour is correct or desirable.
    &lt;/p&gt;
    &lt;p&gt;
        Michael Feathers gives this recipe for writing a Characterization Test:
    &lt;/p&gt;
    &lt;blockquote&gt;
        &lt;ol&gt;
            &lt;li&gt;&quot;Use a piece of code in a test harness.&lt;/li&gt;
            &lt;li&gt;&quot;Write an assertion that you know will fail.&lt;/li&gt;
            &lt;li&gt;&quot;Let the failure tell you what the behavior is.&lt;/li&gt;
            &lt;li&gt;&quot;Change the test so that it expects the behavior that the code produces.&lt;/li&gt;
            &lt;li&gt;&quot;Repeat.&quot;&lt;/li&gt;
        &lt;/ol&gt;
        &lt;footer&gt;&lt;a href=&quot;/ref/wewlc&quot;&gt;Working Effectively with Legacy Code&lt;/a&gt;, ch. 13, Michael C. Feathers, Prentice Hall, 2005&lt;/footer&gt;
    &lt;/blockquote&gt;
    &lt;p&gt;
        Notice the second step: &quot;Write an assertion that you know will fail.&quot; Why is that important? Why not write the &apos;correct&apos; assertion from the outset?
    &lt;/p&gt;
    &lt;p&gt;
        The reason is the same as I outlined in &lt;a href=&quot;/2025/10/20/epistemology-of-software&quot;&gt;Epistemology of software&lt;/a&gt;: It happens with surprising regularity that you inadvertently write a &lt;a href=&quot;/2019/10/14/tautological-assertion&quot;&gt;tautological assertion&lt;/a&gt;. You could also make other mistakes, but writing a failing test is a falsifiable experiment. In this case, the implied hypothesis is that the test will fail. If it does &lt;em&gt;not&lt;/em&gt; fail, you&apos;ve falsified the implied prediction. To paraphrase Dijkstra, you&apos;ve proven the test wrong.
    &lt;/p&gt;
    &lt;p&gt;
        If, on the other hand, the test fails, you&apos;ve failed to falsify the hypothesis. You have not proven the test correct, but you&apos;ve failed in proving it wrong. Epistemologically, that&apos;s the best result you may hope for.
    &lt;/p&gt;
    &lt;p&gt;
        I&apos;m a little uneasy about the above recipe, because it involves a step where you change the test code to pass the test. How can you know that you, without meaning to, replaced a proper assertion with a tautological assertion?
    &lt;/p&gt;
    &lt;p&gt;
        For that reason, I sometimes follow a variation of the recipe:
    &lt;/p&gt;
    &lt;ol&gt;
        &lt;li&gt;Write a test that exercises the SUT, including the correct assertion you have in mind.&lt;/li&gt;
        &lt;li&gt;Run the test to see it pass.&lt;/li&gt;
        &lt;li&gt;Sabotage the SUT so that it fails the assertion. If there are several assertions, do this for each, one after the other.&lt;/li&gt;
        &lt;li&gt;Run the test to see it fail.&lt;/li&gt;
        &lt;li&gt;Revert the sabotage.&lt;/li&gt;
        &lt;li&gt;Run the test again to see it pass.&lt;/li&gt;
        &lt;li&gt;Repeat.&lt;/li&gt;
    &lt;/ol&gt;
    &lt;p&gt;
        The last test run is strictly not necessary if you&apos;ve been rigorous about how you revert the sabotage, but psychologically, it gives me a better sense that all is good if I can end each cycle with a green test suite.
    &lt;/p&gt;
    &lt;h3 id=&quot;7a6abd81fbc541bab29122b0f99484e5&quot;&gt;
        Example &lt;a href=&quot;#7a6abd81fbc541bab29122b0f99484e5&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        I don&apos;t get to interact that much with legacy code, but even so, I find myself writing Characterization Tests with surprising regularity. One example was when I was &lt;a href=&quot;/2025/04/10/characterising-song-recommendations&quot;&gt;characterizing the song recommendations example&lt;/a&gt;. If you have the Git repository that accompanies that article series, you can see that the initial setup is adding one Characterization Test after the other. Even so, as I follow a policy of not adding commits with failing tests, you can&apos;t see the details of the process leading to each commit.
    &lt;/p&gt;
    &lt;p&gt;
        Perhaps a better example can be found in the Git repository that accompanies &lt;a href=&quot;/2021/06/14/new-book-code-that-fits-in-your-head&quot;&gt;Code That Fits in Your Head&lt;/a&gt;. If you own the book, you also have access to the repository. In commit &lt;code&gt;d66bc89443dc10a418837c0ae5b85e06272bd12b&lt;/code&gt; I wrote this message:
    &lt;/p&gt;
    &lt;blockquote&gt;
        &lt;p&gt;
            &quot;Remove PostOffice dependency from Controller
        &lt;/p&gt;
        &lt;p&gt;
            &quot;Instead, the PostOffice behaviour is now the responsibility of the EmailingReservationsRepository Decorator, which is configured in Startup.
        &lt;/p&gt;
        &lt;p&gt;
            &quot;I meticulously edited the unit tests and introduced new unit tests as necessary. All new unit tests I added by following the checklist for Characterisation Tests, including seeing all the assertions fail by temporarily editing the SUT.&quot;
        &lt;/p&gt;
        &lt;footer&gt;Git repository accompanying &lt;a href=&quot;/code-that-fits-in-your-head&quot;&gt;Code That Fits in Your Head&lt;/a&gt;, me, 2020&lt;/footer&gt;
    &lt;/blockquote&gt;
    &lt;p&gt;
        Notice the last paragraph, which is quite typical for how I tend to document my process when it&apos;s otherwise invisible in the Git history. Here&apos;s a breakdown of the process.
    &lt;/p&gt;
    &lt;p&gt;
        I first created the &lt;code&gt;EmailingReservationsRepository&lt;/code&gt; without tests. This class is a &lt;a href=&quot;https://en.wikipedia.org/wiki/Decorator_pattern&quot;&gt;Decorator&lt;/a&gt;, so quite a bit of it is boilerplate code. For instance, one method looks like this:
    &lt;/p&gt;
    &lt;p&gt;
        &lt;pre&gt;&lt;span style=&quot;color:blue;&quot;&gt;public&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Task&lt;/span&gt;&amp;lt;&lt;span style=&quot;color:#2b91af;&quot;&gt;Reservation&lt;/span&gt;?&amp;gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;ReadReservation&lt;/span&gt;(&lt;span style=&quot;color:blue;&quot;&gt;int&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;restaurantId&lt;/span&gt;,&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Guid&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;id&lt;/span&gt;)
{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;return&lt;/span&gt;&amp;nbsp;Inner.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;ReadReservation&lt;/span&gt;(&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;restaurantId&lt;/span&gt;,&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;id&lt;/span&gt;);
}&lt;/pre&gt;
    &lt;/p&gt;
    &lt;p&gt;
        That&apos;s usually the case with such Decorators, but then one of the methods turned out like this:
    &lt;/p&gt;
    &lt;p&gt;
        &lt;pre&gt;&lt;span style=&quot;color:blue;&quot;&gt;public&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;async&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Task&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;Update&lt;/span&gt;(&lt;span style=&quot;color:blue;&quot;&gt;int&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;restaurantId&lt;/span&gt;,&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Reservation&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;reservation&lt;/span&gt;)
{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;if&lt;/span&gt;&amp;nbsp;(&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;reservation&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;is&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;null&lt;/span&gt;)
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;throw&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;new&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;ArgumentNullException&lt;/span&gt;(&lt;span style=&quot;color:blue;&quot;&gt;nameof&lt;/span&gt;(&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;reservation&lt;/span&gt;));
 
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;var&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;existing&lt;/span&gt;&amp;nbsp;=
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;await&lt;/span&gt;&amp;nbsp;Inner.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;ReadReservation&lt;/span&gt;(&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;restaurantId&lt;/span&gt;,&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;reservation&lt;/span&gt;.Id)
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;ConfigureAwait&lt;/span&gt;(&lt;span style=&quot;color:blue;&quot;&gt;false&lt;/span&gt;);
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;if&lt;/span&gt;&amp;nbsp;(&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;existing&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;is&lt;/span&gt;&amp;nbsp;{&amp;nbsp;}&amp;nbsp;&amp;amp;&amp;amp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;existing&lt;/span&gt;.Email&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;!=&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;reservation&lt;/span&gt;.Email)
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;await&lt;/span&gt;&amp;nbsp;PostOffice
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;EmailReservationUpdating&lt;/span&gt;(&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;restaurantId&lt;/span&gt;,&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;existing&lt;/span&gt;)
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;ConfigureAwait&lt;/span&gt;(&lt;span style=&quot;color:blue;&quot;&gt;false&lt;/span&gt;);
 
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;await&lt;/span&gt;&amp;nbsp;Inner.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;Update&lt;/span&gt;(&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;restaurantId&lt;/span&gt;,&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;reservation&lt;/span&gt;)
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;ConfigureAwait&lt;/span&gt;(&lt;span style=&quot;color:blue;&quot;&gt;false&lt;/span&gt;);
 
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;await&lt;/span&gt;&amp;nbsp;PostOffice.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;EmailReservationUpdated&lt;/span&gt;(&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;restaurantId&lt;/span&gt;,&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;reservation&lt;/span&gt;)
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;ConfigureAwait&lt;/span&gt;(&lt;span style=&quot;color:blue;&quot;&gt;false&lt;/span&gt;);
}&lt;/pre&gt;
    &lt;/p&gt;
    &lt;p&gt;
        I then realized that I should probably cover this class with some tests after all, which I then proceeded to do in the above commit.
    &lt;/p&gt;
    &lt;p&gt;
        Consider one of the &lt;a href=&quot;/2019/02/18/from-interaction-based-to-state-based-testing&quot;&gt;state-based&lt;/a&gt; Characterisation Tests I added to cover the &lt;code&gt;Update&lt;/code&gt; method.
    &lt;/p&gt;
    &lt;p&gt;
        &lt;pre&gt;[&lt;span style=&quot;color:#2b91af;&quot;&gt;Theory&lt;/span&gt;]
[&lt;span style=&quot;color:#2b91af;&quot;&gt;InlineData&lt;/span&gt;(32,&amp;nbsp;&lt;span style=&quot;color:#a31515;&quot;&gt;&amp;quot;David&amp;quot;&lt;/span&gt;)]
[&lt;span style=&quot;color:#2b91af;&quot;&gt;InlineData&lt;/span&gt;(58,&amp;nbsp;&lt;span style=&quot;color:#a31515;&quot;&gt;&amp;quot;Robert&amp;quot;&lt;/span&gt;)]
[&lt;span style=&quot;color:#2b91af;&quot;&gt;InlineData&lt;/span&gt;(58,&amp;nbsp;&lt;span style=&quot;color:#a31515;&quot;&gt;&amp;quot;Jones&amp;quot;&lt;/span&gt;)]
&lt;span style=&quot;color:blue;&quot;&gt;public&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;async&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Task&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;UpdateSendsEmail&lt;/span&gt;(&lt;span style=&quot;color:blue;&quot;&gt;int&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;restaurantId&lt;/span&gt;,&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;string&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;newName&lt;/span&gt;)
{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;var&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;postOffice&lt;/span&gt;&amp;nbsp;=&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;new&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;SpyPostOffice&lt;/span&gt;();
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;var&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;existing&lt;/span&gt;&amp;nbsp;=&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Some&lt;/span&gt;.Reservation;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;var&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;db&lt;/span&gt;&amp;nbsp;=&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;new&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;FakeDatabase&lt;/span&gt;();
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;await&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;db&lt;/span&gt;.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;Create&lt;/span&gt;(&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;restaurantId&lt;/span&gt;,&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;existing&lt;/span&gt;);
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;var&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;sut&lt;/span&gt;&amp;nbsp;=&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;new&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;EmailingReservationsRepository&lt;/span&gt;(&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;postOffice&lt;/span&gt;,&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;db&lt;/span&gt;);
 
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;var&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;updated&lt;/span&gt;&amp;nbsp;=&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;existing&lt;/span&gt;.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;WithName&lt;/span&gt;(&lt;span style=&quot;color:blue;&quot;&gt;new&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Name&lt;/span&gt;(&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;newName&lt;/span&gt;));
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;await&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;sut&lt;/span&gt;.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;Update&lt;/span&gt;(&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;restaurantId&lt;/span&gt;,&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;updated&lt;/span&gt;);
 
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;var&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;expected&lt;/span&gt;&amp;nbsp;=&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;new&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;SpyPostOffice&lt;/span&gt;.&lt;span style=&quot;color:#2b91af;&quot;&gt;Observation&lt;/span&gt;(
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;SpyPostOffice&lt;/span&gt;.&lt;span style=&quot;color:#2b91af;&quot;&gt;Event&lt;/span&gt;.Updated,
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;restaurantId&lt;/span&gt;,
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;updated&lt;/span&gt;);
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Assert&lt;/span&gt;.&lt;span style=&quot;color:#74531f;&quot;&gt;Contains&lt;/span&gt;(&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;updated&lt;/span&gt;,&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;db&lt;/span&gt;[&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;restaurantId&lt;/span&gt;]);
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Assert&lt;/span&gt;.&lt;span style=&quot;color:#74531f;&quot;&gt;Contains&lt;/span&gt;(&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;expected&lt;/span&gt;,&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;postOffice&lt;/span&gt;);
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Assert&lt;/span&gt;.&lt;span style=&quot;color:#74531f;&quot;&gt;DoesNotContain&lt;/span&gt;(
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;postOffice&lt;/span&gt;,
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;o&lt;/span&gt;&amp;nbsp;=&amp;gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;o&lt;/span&gt;.Event&amp;nbsp;==&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;SpyPostOffice&lt;/span&gt;.&lt;span style=&quot;color:#2b91af;&quot;&gt;Event&lt;/span&gt;.Updating);
}&lt;/pre&gt;
    &lt;/p&gt;
    &lt;p&gt;
        This test immediately passed when I added it, so I had to sabotage the &lt;code&gt;Update&lt;/code&gt; method to see the assertions fail. Since there are three assertions, I had to sabotage the SUT in three different ways.
    &lt;/p&gt;
    &lt;p&gt;
        To see the first assertion fail, the most obvious sabotage was to simply comment out or delete the delegation to &lt;code&gt;Inner.Update&lt;/code&gt;:
    &lt;/p&gt;
    &lt;p&gt;
        &lt;pre&gt;&lt;span style=&quot;color:green;&quot;&gt;//await&amp;nbsp;Inner.Update(restaurantId,&amp;nbsp;reservation)&lt;/span&gt;
&lt;span style=&quot;color:green;&quot;&gt;//&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;.ConfigureAwait(false);&lt;/span&gt;&lt;/pre&gt;
    &lt;/p&gt;
    &lt;p&gt;
        This caused the first assertion to fail. I was sure to actually look at the error message and follow the link to the test failure to make sure that it was, indeed, &lt;em&gt;that&lt;/em&gt; assertion that was failing, and not something else. Once I had that verified, I undid the sabotage.
    &lt;/p&gt;
    &lt;p&gt;
        With the SUT back to unedited state, it was time to sabotage the second assertion. Just like &lt;code&gt;FakeDatabase&lt;/code&gt; inherits from &lt;a href=&quot;https://learn.microsoft.com/dotnet/api/system.collections.concurrent.concurrentdictionary-2&quot;&gt;ConcurrentDictionary&lt;/a&gt;, &lt;code&gt;SpyPostOffice&lt;/code&gt; inherits from &lt;a href=&quot;https://learn.microsoft.com/dotnet/api/system.collections.objectmodel.collection-1&quot;&gt;Collection&lt;/a&gt;, which means that the assertion can simply verify whether the &lt;code&gt;postOffice&lt;/code&gt; contains the &lt;code&gt;expected&lt;/code&gt; observation. Sabotaging that part was as easy as the first one:
    &lt;/p&gt;
    &lt;p&gt;
        &lt;pre&gt;&lt;span style=&quot;color:green;&quot;&gt;//await&amp;nbsp;PostOffice.EmailReservationUpdated(restaurantId,&amp;nbsp;reservation)&lt;/span&gt;
&lt;span style=&quot;color:green;&quot;&gt;//&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;.ConfigureAwait(false);&lt;/span&gt;&lt;/pre&gt;
    &lt;/p&gt;
    &lt;p&gt;
        The test failed, but again I meticulously verified that the error was the expected error at the expected line. Once I&apos;d done that, I again reverted the SUT to its virgin state, and ran the test to verify that all tests passed.
    &lt;/p&gt;
    &lt;p&gt;
        The last assertion is a bit different, because it checks that no &lt;code&gt;Updating&lt;/code&gt; message is being sent. This should only happen if the user updates the reservation by changing his or her email address. In that case, but only in that case, should the system send an &lt;code&gt;Updating&lt;/code&gt; message to the old address, and an &lt;code&gt;Updated&lt;/code&gt; message to the new address. There&apos;s a separate test for that, but as it follows the same overall template as the one shown here, I&apos;m not showing it. You can see it in the Git repository.
    &lt;/p&gt;
    &lt;p&gt;
        Here&apos;s how to sabotage the SUT to see the third assertion fail:
    &lt;/p&gt;
    &lt;p&gt;
        &lt;pre&gt;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;if&lt;/span&gt;&amp;nbsp;(&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;existing&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;is&lt;/span&gt;&amp;nbsp;{&amp;nbsp;}&amp;nbsp;&lt;span style=&quot;color:green;&quot;&gt;/*&amp;amp;&amp;amp;&amp;nbsp;existing.Email&amp;nbsp;!=&amp;nbsp;reservation.Email*/&lt;/span&gt;)
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;await&lt;/span&gt;&amp;nbsp;PostOffice
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;EmailReservationUpdating&lt;/span&gt;(&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;restaurantId&lt;/span&gt;,&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;existing&lt;/span&gt;)
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;ConfigureAwait&lt;/span&gt;(&lt;span style=&quot;color:blue;&quot;&gt;false&lt;/span&gt;);&lt;/pre&gt;
    &lt;/p&gt;
    &lt;p&gt;
        It&apos;s enough to comment out (or delete) the second Boolean check to fail the assertion. Again, I made sure to check that the test failed on the exact line of the third assertion. Once I&apos;d made sure of that, I undid the change, ran the tests again, and committed the changes.
    &lt;/p&gt;
    &lt;h3 id=&quot;b2fd9167c4c24950ac7ba47df057af63&quot;&gt;
        Conclusion &lt;a href=&quot;#b2fd9167c4c24950ac7ba47df057af63&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        When working with automated tests, a classic conundrum is that you&apos;re writing code to test some other code. How do you know that the test code is correct? After all, you&apos;re writing test code because you don&apos;t trust your abilities to produce perfect production code. The way out of that quandary is to first predict that the test will fail and run that experiment. If you haven&apos;t touched the production code, but the test passes, odds are that there&apos;s something wrong with the test.
    &lt;/p&gt;
    &lt;p&gt;
        When you are adding tests to an existing code base, you can&apos;t perform that experiment without jumping through some hoops. After all, the behaviour you want to observe is already implemented. You must therefore either write a variation of a test that deliberately fails (as Michael Feathers recommends), or temporarily sabotage the system under test so that you can verify that the new test fails as expected.
    &lt;/p&gt;
    &lt;p&gt;
        The example shows how to proceed empirically with a Characterisation Test of a C# class that I&apos;d earlier added without tests. Perhaps, however, I should have rather approached the situation in another way.
    &lt;/p&gt;
    &lt;p&gt;
        &lt;strong&gt;Next:&lt;/strong&gt; &lt;a href=&quot;/2025/11/17/empirical-software-prototyping&quot;&gt;Empirical software prototyping&lt;/a&gt;.
    &lt;/p&gt;
&lt;/div&gt;&lt;hr&gt;
      This blog is totally free, but if you like it, please consider &lt;a href="https://blog.ploeh.dk/support"&gt;supporting it&lt;/a&gt;.</description>
        <author>Mark Seemann</author>
        <guid isPermaLink="false">https://blog.ploeh.dk/2025/11/03/empirical-characterization-testing</guid>
      </item>
    
      <item>
        <title>Empirical test-after development</title>
        <link>https://blog.ploeh.dk/2025/10/27/empirical-test-after-development/</link>
        <pubDate>Mon, 27 Oct 2025 06:42:00 UTC</pubDate>
        <description>


&lt;div id=&quot;post&quot;&gt;
    &lt;p&gt;
        &lt;em&gt;A few techniques for situations where TDD is impractical.&lt;/em&gt;
    &lt;/p&gt;
    &lt;p&gt;
        In &lt;a href=&quot;/2025/10/20/epistemology-of-software&quot;&gt;Epistemology of software&lt;/a&gt; I described how test-driven development (TDD) is a scientific approach to software development. By running tests, we conduct &lt;a href=&quot;https://en.wikipedia.org/wiki/Falsifiability&quot;&gt;falsifiable&lt;/a&gt; experiments to gather empirical evidence that corroborate our hypothesis about the software we&apos;re developing.
    &lt;/p&gt;
    &lt;p&gt;
        TDD is, in my experience, the most effective way to deliver useful software within reasonable time frames. Even so, I also understand that there are situations where TDD is impractical. I can think of a few overall categories where this is the case, but undoubtedly, there are more than those I enumerate in this article.
    &lt;/p&gt;
    &lt;p&gt;
        Not all is lost in those cases. What do you do when TDD seems impractical? The key is to understand how empirical methods work. How do you gather evidence that corroborates your hypotheses? In subsequent articles, I&apos;ll share some techniques that I&apos;ve found useful.
    &lt;/p&gt;
    &lt;ul&gt;
        &lt;li&gt;&lt;a href=&quot;/2025/11/03/empirical-characterization-testing&quot;&gt;Empirical Characterization Testing&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href=&quot;/2025/11/17/empirical-software-prototyping&quot;&gt;Empirical software prototyping&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
    &lt;p&gt;
        Each of these articles will contain tips and examples that apply in those situations where TDD is impractical. Most of the ideas and techniques I&apos;ve learned from other people, and I&apos;ll be as diligent as possible to cite sources of inspiration.
    &lt;/p&gt;
    &lt;p&gt;
        &lt;strong&gt;Next:&lt;/strong&gt; &lt;a href=&quot;/2025/11/03/empirical-characterization-testing&quot;&gt;Empirical Characterization Testing&lt;/a&gt;.
    &lt;/p&gt;
&lt;/div&gt;&lt;hr&gt;
      This blog is totally free, but if you like it, please consider &lt;a href="https://blog.ploeh.dk/support"&gt;supporting it&lt;/a&gt;.</description>
        <author>Mark Seemann</author>
        <guid isPermaLink="false">https://blog.ploeh.dk/2025/10/27/empirical-test-after-development</guid>
      </item>
    
      <item>
        <title>Epistemology of software</title>
        <link>https://blog.ploeh.dk/2025/10/20/epistemology-of-software/</link>
        <pubDate>Mon, 20 Oct 2025 06:16:00 UTC</pubDate>
        <description>


&lt;div id=&quot;post&quot;&gt;
    &lt;p&gt;
        &lt;em&gt;How do you know that your code works?&lt;/em&gt;
    &lt;/p&gt;
    &lt;p&gt;
        In 2023 I gave a conference keynote titled &lt;em&gt;Epistemology of software&lt;/em&gt;, a recording of which is &lt;a href=&quot;https://youtu.be/bLpwNWWs5EY?si=SwLJ_H6WtQDEDayK&quot;&gt;available on YouTube&lt;/a&gt;. In it, I try to answer the question: How do we know that software works?
    &lt;/p&gt;
    &lt;p&gt;
        The keynote was for a mixed audience with some technical, but also a big contingent of non-technical, software people, so I took a long detour around general &lt;a href=&quot;https://en.wikipedia.org/wiki/Epistemology&quot;&gt;epistemology&lt;/a&gt;, and particularly the philosophy of science as it pertains to empirical science. Towards the end of the presentation, I returned to the epistemology of software in particular. While I recommend that you watch the recording for a broader perspective, I want to reiterate the points about software development here. Personally, I like prose better than video when it comes to succinctly present and preserve ideas.
    &lt;/p&gt;
    &lt;h3 id=&quot;1416a12dc0a745fa99c643856b709975&quot;&gt;
        How do we know anything? &lt;a href=&quot;#1416a12dc0a745fa99c643856b709975&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        In philosophy of science it&apos;s long been an established truth that we can&apos;t know anything with certainty. We can only edge asymptotically closer to what we believe is the &apos;truth&apos;. The most effective method for that is the &apos;scientific method&apos;, which grossly simplified is an iterative process of forming hypotheses, making predictions, performing experiments, and corroborating or falsifying predictions. When experiments don&apos;t quite turn out as predicted, you may adjust your hypothesis accordingly.
    &lt;/p&gt;
    &lt;p&gt;
        &lt;img src=&quot;/content/binary/prediction-experiment-adjustment-cycle.png&quot; alt=&quot;Cycle with arrows from prediction to experiment, from experiment to adjustment, and from adjustment to prediction.&quot; width=&quot;400&quot;&gt;
    &lt;/p&gt;
    &lt;p&gt;
        An example, however, may still be useful to set the stage. Consider &lt;a href=&quot;https://en.wikipedia.org/wiki/Galileo_Galilei&quot;&gt;Galilei&lt;/a&gt;&apos;s idea of dropping a small and a big ball from the &lt;a href=&quot;https://en.wikipedia.org/wiki/Leaning_Tower_of_Pisa&quot;&gt;Leaning Tower of Pisa&lt;/a&gt;. The prediction is that two objects of different mass will hit the ground simultaneously, if dropped from the same height simultaneously. This experiment have been carried out multiple times, even &lt;a href=&quot;https://youtu.be/E43-CfukEgs?si=kkg-Gxscr-7UUfM7&quot;&gt;in vacuum chambers&lt;/a&gt;.
    &lt;/p&gt;
    &lt;p&gt;
        Even so, thousands of experiments do not constitute &lt;em&gt;proof&lt;/em&gt; that two objects fall with the same acceleration. The experiments only make it exceedingly likely that this is so.
    &lt;/p&gt;
    &lt;p&gt;
        What happens if you apply scientific thinking to software development?
    &lt;/p&gt;
    &lt;h3 id=&quot;77040a20e7804b43ba220a3332813a16&quot;&gt;
        Empirical epistemology of software &lt;a href=&quot;#77040a20e7804b43ba220a3332813a16&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        Put yourself in the shoes of a non-coding product owner. He or she needs an application to solve a particular problem. How does he or she know when that goal has been reached?
    &lt;/p&gt;
    &lt;p&gt;
        Ultimately, he or she can only do what any scientist can do: Form hypotheses, make predictions, and perform experiments. Sometimes product owners assign these jobs to other people, but so do scientists.
    &lt;/p&gt;
    &lt;p&gt;
        &lt;img src=&quot;/content/binary/write-software-test-shatter-all-illusions-cycle.png&quot; alt=&quot;Cycle with arrows from write software to test, from test to shatter all illusions, and from shatter all illusions to write software.&quot; width=&quot;400&quot;&gt;
    &lt;/p&gt;
    &lt;p&gt;
        Testing can be ad-hoc or planned, automated or manual, thorough or cursory, but it&apos;s really the only way a product owner can determine whether or not the software works.
    &lt;/p&gt;
    &lt;p&gt;
        When I started as a software developer, testing was often the purview of a dedicated testing department. The test manager would oversee the production of a &lt;em&gt;test plan&lt;/em&gt;, which was a written document that manual testers were supposed to follow. Even so, this, too, is an empirical approach to software verification. Each test essentially implies a hypothesis: If we perform these steps, the application will behave in this particular, observable manner.
    &lt;/p&gt;
    &lt;p&gt;
        For an application designed for human interaction, letting a real human tester interact with it may be the most realistic test scenario, but human testers are slow. They also tend to make mistakes. The twentieth time they run through the same test scenario, they are likely to overlook details.
    &lt;/p&gt;
    &lt;p&gt;
        If you want to perform faster, and more reliable, tests, you may wish to automated the tests. You could, for example, write code that executes a test plan. This, however, raises another problem: If tests are also code, how do we know that the tests contain no bugs?
    &lt;/p&gt;
    &lt;h3 id=&quot;346c4408124b4fa7ad16fe5a5aa37bb2&quot;&gt;
        The scientific method of software &lt;a href=&quot;#346c4408124b4fa7ad16fe5a5aa37bb2&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        How about using the the scientific method? Even more specifically, proceed by making incremental &lt;a href=&quot;https://en.wikipedia.org/wiki/Falsifiability&quot;&gt;falsifiable&lt;/a&gt; predictions about the code you write.
    &lt;/p&gt;
    &lt;p&gt;
        For instance, write a single automated test without accompanying production code:
    &lt;/p&gt;
    &lt;p&gt;
        &lt;img src=&quot;/content/binary/science-of-tdd-first-test-no-production-code.png&quot; alt=&quot;Two boxes labelled &apos;production code&apos; and &apos;test code&apos;. The test-code box contains a single red arrow going from a to b.&quot; width=&quot;500&quot;&gt;
    &lt;/p&gt;
    &lt;p&gt;
        Before you run the test code, you make a prediction based on the implicit hypothesis formulated by the &lt;a href=&quot;/2019/10/21/a-red-green-refactor-checklist&quot;&gt;red-green-refactor checklist&lt;/a&gt;: &lt;em&gt;If this test runs, it will fail&lt;/em&gt;.
    &lt;/p&gt;
    &lt;p&gt;
        This is a falsifiable prediction. While you expect the test to fail, it may succeed if, for example, you&apos;ve inadvertently written a &lt;a href=&quot;/2019/10/14/tautological-assertion&quot;&gt;tautological assertion&lt;/a&gt;. In other words, if your prediction is falsified, you know that the test code is somehow wrong. On the other hand, if the test fails (as predicted), you&apos;ve failed to falsify your prediction. As empirical science goes, this is the best you can hope for. It doesn&apos;t prove that the test is correct, but corroborates the hypothesis that it is.
    &lt;/p&gt;
    &lt;p&gt;
        The next step in the red-green-refactor cycle is to write just enough code to pass the test. You do that, and before rerunning the test implicitly formulate the opposite hypothesis: &lt;em&gt;If this test runs, it will succeed&lt;/em&gt;.
    &lt;/p&gt;
    &lt;p&gt;
        &lt;img src=&quot;/content/binary/science-of-tdd-first-test-just-enough-production-code.png&quot; alt=&quot;Two boxes labelled &apos;production code&apos; and &apos;test code&apos;. The test-code box contains a single red arrow going from a to b. The product code box contains green arrows going from a to b to c.&quot; width=&quot;500&quot;&gt;
    &lt;/p&gt;
    &lt;p&gt;
        This, again, is a falsifiable prediction. If, despite expectations, the test fails, you know that something is wrong. Most likely, it&apos;s the implementation that you just wrote, but it could also be the test which, after all, is somehow defective. Or perhaps a circuit in your computer was struck by a cosmic ray. On the other hand, if the test passes, you&apos;ve failed to falsify your prediction, which is the best you can hope for.
    &lt;/p&gt;
    &lt;p&gt;
        You now write a second test, which comes with the implicit falsifiable prediction: &lt;em&gt;If I run all tests, the new test will fail&lt;/em&gt;.
    &lt;/p&gt;
    &lt;p&gt;
        &lt;img src=&quot;/content/binary/science-of-tdd-second-test-no-new-production-code.png&quot; alt=&quot;Two boxes labelled &apos;production code&apos; and &apos;test code&apos;. The test-code box contains a single blue arrow going from a to b, and red arrow going from a to g. The product code box contains green arrows going from a to b to c.&quot; width=&quot;500&quot;&gt;
    &lt;/p&gt;
    &lt;p&gt;
        The process repeats. A succeeding test falsifies the prediction, while a failing test only corroborates the hypothesis.
    &lt;/p&gt;
    &lt;p&gt;
        Again, implement just enough code for the hypothesis that if you run all tests, they will pass.
    &lt;/p&gt;
    &lt;p&gt;
        &lt;img src=&quot;/content/binary/science-of-tdd-second-test-just-enough-production-code.png&quot; alt=&quot;Two boxes labelled &apos;production code&apos; and &apos;test code&apos;. The test-code box contains a single blue arrow going from a to b, and red arrow going from a to g. The product code box contains green arrows going from a to b to c, and other arrows branching off from b to go to g via e.&quot; width=&quot;500&quot;&gt;
    &lt;/p&gt;
    &lt;p&gt;
        If this hypothesis, too, is corroborated (i.e. you failed to falsify it), you move on until you believe that you&apos;re done.
    &lt;/p&gt;
    &lt;p&gt;
        &lt;img src=&quot;/content/binary/science-of-tdd-third-test-just-enough-production-code.png&quot; alt=&quot;Two boxes labelled &apos;production code&apos; and &apos;test code&apos;. The test-code box contains blue arrows going from a to b, from a to g, and another arrow going from a to h. The product code box contains green arrows going from a to b to c, and other arrows branching off from b to go to g via e, and yet another set of arrows going from a to d to f to h.&quot; width=&quot;500&quot;&gt;
    &lt;/p&gt;
    &lt;p&gt;
        As this process proceeds, you corroborate two related hypotheses: That the test code is correct, and that the production code is. None of these hypotheses are ever proven, but as you add tests that are first red, then green, and then stay green, you increase confidence that the entire code complex works as intended.
    &lt;/p&gt;
    &lt;p&gt;
        If you don&apos;t write the test first, you don&apos;t get to perform the first experiment: That you predict the new test to fail. If you don&apos;t do that, you collect no empirical evidence that the tests work as hypothesized. In other words, you&apos;d lose half of the scientific evidence you otherwise could have gathered.
    &lt;/p&gt;
    &lt;h3 id=&quot;119d07352baa4bb38627329eede93654&quot;&gt;
        TDD is the scientific method &lt;a href=&quot;#119d07352baa4bb38627329eede93654&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        Let me spell this out: Test-driven development (TDD) is an example of the scientific method. Watching a new test fail is an important part of the process. Without it, you have no empirical reason to believe that the tests are correct.
    &lt;/p&gt;
    &lt;p&gt;
        While you may &lt;em&gt;read&lt;/em&gt; the test code, that only puts you on the same scientific footing as the ancient Greeks&apos; introspective philosophy: &lt;a href=&quot;https://en.wikipedia.org/wiki/Humorism&quot;&gt;The four humours&lt;/a&gt;, &lt;a href=&quot;https://en.wikipedia.org/wiki/Emission_theory_(vision)&quot;&gt;extramission&lt;/a&gt;, &lt;a href=&quot;https://en.wikipedia.org/wiki/Classical_element&quot;&gt;the elements&lt;/a&gt;, etc. By reading test code, or even writing it, you may believe that you understand what the code does, but reading it without running it gives you no empirical way to verify whether that belief is correct.
    &lt;/p&gt;
    &lt;p&gt;
        Consider: How many times have you written code that you believed was correct, but turned out contained errors?
    &lt;/p&gt;
    &lt;p&gt;
        If you write the test &lt;em&gt;after&lt;/em&gt; the system under test (SUT), you can run the test to see it pass, but consider what you can only falsify in that case: If the test passes, you&apos;ve learned little. It &lt;em&gt;may&lt;/em&gt; be that the test exercises the SUT, but it may also be that you&apos;ve written a &lt;a href=&quot;/2019/10/14/tautological-assertion&quot;&gt;tautological assertion&lt;/a&gt;. It may also be that you&apos;ve faithfully captured a bug in the production code, and now preserved in for eternity as something that looks like a regression test. Or perhaps the test doesn&apos;t even cover the code path that you believe it covers.
    &lt;/p&gt;
    &lt;p&gt;
        Conversely, if such a test (that you believe to be correct) fails, you&apos;re also in the dark. Was the test wrong, after all? Or does the SUT have a defect?
    &lt;/p&gt;
    &lt;p&gt;
        This is the reason that the process for writing &lt;a href=&quot;https://en.wikipedia.org/wiki/Characterization_test&quot;&gt;Characterization Tests&lt;/a&gt; includes a step where you
    &lt;/p&gt;
    &lt;blockquote&gt;
        &lt;p&gt;
            &quot;Write an assertion that you know will fail.&quot;
        &lt;/p&gt;
        &lt;footer&gt;&lt;cite&gt;&lt;a href=&quot;/ref/wewlc&quot;&gt;Working Effectively with Legacy Code&lt;/a&gt;&lt;/cite&gt;, Michael Feathers, Prentice Hall, 2005&lt;/footer&gt;
    &lt;/blockquote&gt;
    &lt;p&gt;
        I prefer a variation where I write what I believe is the correct assertion, but then temporarily sabotage the SUT to fail the assertion. The important part is to see the test fail, because the failure to falsify a strong prediction is important empirical evidence.
    &lt;/p&gt;
    &lt;h3 id=&quot;528753dd0ff844c9a61ddccf96469be4&quot;&gt;
        Conclusion &lt;a href=&quot;#528753dd0ff844c9a61ddccf96469be4&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        How do we know that the software we develop works as intended? The answer lies in the much larger question: How do we know anything?
    &lt;/p&gt;
    &lt;p&gt;
        Scientific thinking effectively answers this by &apos;the scientific method&apos;: Form a hypothesis, make falsifiable predictions, perform experiments, adjust, repeat.
    &lt;/p&gt;
    &lt;p&gt;
        We can subject software to the same rigorous regimen that scientists do: Hypothesize that the software works in certain ways under given conditions, predict observable behaviour, test, record outcomes, fix defects, repeat.
    &lt;/p&gt;
    &lt;p&gt;
        Test-driven development closely follows that process, so is a highly scientific methodology for developing software. It should be noted that science is hard, and so is TDD. Still, if you care that your software behaves as it&apos;s supposed to, it&apos;s one of the most rigorous and effective processes I&apos;m aware of.
    &lt;/p&gt;
&lt;/div&gt;&lt;hr&gt;
      This blog is totally free, but if you like it, please consider &lt;a href="https://blog.ploeh.dk/support"&gt;supporting it&lt;/a&gt;.</description>
        <author>Mark Seemann</author>
        <guid isPermaLink="false">https://blog.ploeh.dk/2025/10/20/epistemology-of-software</guid>
      </item>
    
      <item>
        <title>Result isomorphism</title>
        <link>https://blog.ploeh.dk/2025/10/15/result-isomorphism/</link>
        <pubDate>Wed, 15 Oct 2025 14:47:00 UTC</pubDate>
        <description>


&lt;div id=&quot;post&quot;&gt;
    &lt;p&gt;
        &lt;em&gt;Result types are roughly equivalent to exceptions.&lt;/em&gt;
    &lt;/p&gt;
    &lt;p&gt;
        This article is part of a &lt;a href=&quot;/2018/01/08/software-design-isomorphisms&quot;&gt;a series about software design isomorphisms&lt;/a&gt;, although naming this one an &lt;em&gt;isomorphism&lt;/em&gt; is a stretch. A real isomorphism is when a lossless translation exists between two or more different representations. This article series has already shown a few examples that fit the definition better than what the present article will manage.
    &lt;/p&gt;
    &lt;p&gt;
        The reader, I hope, will bear with me. The overall series of software design isomorphisms establishes a theme, and even when a topic doesn&apos;t fit the definition to a T, I find that it harmonizes well enough that it still belongs.
    &lt;/p&gt;
    &lt;p&gt;
        In short, the claim made here is that &apos;Result&apos; (or &lt;a href=&quot;/2018/06/11/church-encoded-either&quot;&gt;Either&lt;/a&gt;) types are equivalent to exceptions.
    &lt;/p&gt;
    &lt;p&gt;
        &lt;img src=&quot;/content/binary/result-exception-equivalence.png&quot; alt=&quot;Two boxes labelled &apos;exception&apos; and &apos;result&apos;, respectively, with curved arrows pointing from each to the other.&quot; width=&quot;400&quot;&gt;
    &lt;/p&gt;
    &lt;p&gt;
        I&apos;ve deliberately drawn the arrows in such a way that they fade or wash out as they approach their target. My intent is to suggest that there is &lt;em&gt;some&lt;/em&gt; loss of information. We may consider exceptions and result types to be roughly equivalent, but they do, in general, have different semantics. The exact semantics are language-dependent, but most languages tend to align with each other when it comes to exceptions. If they have exceptions at all.
    &lt;/p&gt;
    &lt;h3 id=&quot;7ee6ef778c2e4268a2b6e02af7babb60&quot;&gt;
        Checked exceptions &lt;a href=&quot;#7ee6ef778c2e4268a2b6e02af7babb60&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        As far as I&apos;m aware, the language where exceptions and results are most similar may be &lt;a href=&quot;https://www.java.com&quot;&gt;Java&lt;/a&gt;, which has &lt;em&gt;checked exceptions&lt;/em&gt;. This means that a method may declare that it throws certain exceptions. Any callers must either handle all declared exceptions, or rethrow them, thereby transitively declare to &lt;em&gt;their&lt;/em&gt; callers that they must expect certain exceptions to be thrown.
    &lt;/p&gt;
    &lt;p&gt;
        Imagine, for example, that you want to create a library of basic statistical calculations. You may start out with this variation of &lt;code&gt;mean&lt;/code&gt;:
    &lt;/p&gt;
    &lt;p&gt;
        &lt;pre&gt;&lt;span style=&quot;color:blue;&quot;&gt;public&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;double&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;mean&lt;/span&gt;(&lt;span style=&quot;color:blue;&quot;&gt;double&lt;/span&gt;[]&amp;nbsp;values)&amp;nbsp;{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;if&lt;/span&gt;&amp;nbsp;(values&amp;nbsp;==&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;null&lt;/span&gt;&amp;nbsp;||&amp;nbsp;values.length&amp;nbsp;==&amp;nbsp;0)&amp;nbsp;{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;throw&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;new&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;IllegalArgumentException&lt;/span&gt;(
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:#a31515;&quot;&gt;&amp;quot;The&amp;nbsp;parameter&amp;nbsp;&amp;#39;values&amp;#39;&amp;nbsp;must&amp;nbsp;not&amp;nbsp;be&amp;nbsp;null&amp;nbsp;or&amp;nbsp;empty.&amp;quot;&lt;/span&gt;);
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;double&lt;/span&gt;&amp;nbsp;sum&amp;nbsp;=&amp;nbsp;0;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;for&lt;/span&gt;&amp;nbsp;(&lt;span style=&quot;color:blue;&quot;&gt;double&lt;/span&gt;&amp;nbsp;value&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;:&lt;/span&gt;&amp;nbsp;values)&amp;nbsp;{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;sum&amp;nbsp;+=&amp;nbsp;value;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;return&lt;/span&gt;&amp;nbsp;sum&amp;nbsp;/&amp;nbsp;values.length;
}&lt;/pre&gt;
    &lt;/p&gt;
    &lt;p&gt;
        Since it&apos;s impossible to calculate the mean for an empty data set, this method throws an exception. If we had omitted the Guard Clause, the method would have returned &lt;code&gt;NaN&lt;/code&gt;, a questionable language design choice, if you ask me.
    &lt;/p&gt;
    &lt;p&gt;
        One would think that you could add &lt;code&gt;throws&amp;nbsp;IllegalArgumentException&lt;/code&gt; to the method declaration in order to force callers to deal with the problem, but alas, &lt;code&gt;IllegalArgumentException&lt;/code&gt; is a &lt;code&gt;RuntimeException&lt;/code&gt;, so no caller is forced to deal with this exception, after all.
    &lt;/p&gt;
    &lt;p&gt;
        Purely for the sake of argument, we may introduce a special &lt;code&gt;StatisticsException&lt;/code&gt; class as a checked exception, and change the &lt;code&gt;mean&lt;/code&gt; method to this variation:
    &lt;/p&gt;
    &lt;p&gt;
        &lt;pre&gt;&lt;span style=&quot;color:blue;&quot;&gt;public&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;static&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;double&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;mean&lt;/span&gt;(&lt;span style=&quot;color:blue;&quot;&gt;double&lt;/span&gt;[]&amp;nbsp;values)&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;throws&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;StatisticsException&lt;/span&gt;&amp;nbsp;{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;if&lt;/span&gt;&amp;nbsp;(values&amp;nbsp;==&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;null&lt;/span&gt;&amp;nbsp;||&amp;nbsp;values.length&amp;nbsp;==&amp;nbsp;0)&amp;nbsp;{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;throw&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;new&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;StatisticsException&lt;/span&gt;(
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:#a31515;&quot;&gt;&amp;quot;The&amp;nbsp;parameter&amp;nbsp;&amp;#39;values&amp;#39;&amp;nbsp;must&amp;nbsp;not&amp;nbsp;be&amp;nbsp;null&amp;nbsp;or&amp;nbsp;empty.&amp;quot;&lt;/span&gt;);
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;double&lt;/span&gt;&amp;nbsp;sum&amp;nbsp;=&amp;nbsp;0;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;for&lt;/span&gt;&amp;nbsp;(&lt;span style=&quot;color:blue;&quot;&gt;double&lt;/span&gt;&amp;nbsp;value&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;:&lt;/span&gt;&amp;nbsp;values)&amp;nbsp;{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;sum&amp;nbsp;+=&amp;nbsp;value;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;return&lt;/span&gt;&amp;nbsp;sum&amp;nbsp;/&amp;nbsp;values.length;
}&lt;/pre&gt;
    &lt;/p&gt;
    &lt;p&gt;
        Since the new &lt;code&gt;StatisticsException&lt;/code&gt; class is a checked exception, callers must handle that exception, or declare that they themselves throw that exception type. Even unit tests have to do that:
    &lt;/p&gt;
    &lt;p&gt;
        &lt;pre&gt;&lt;span style=&quot;color:blue;&quot;&gt;@Test&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;void&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;meanOfOneValueIsTheValueItself&lt;/span&gt;()&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;throws&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;StatisticsException&lt;/span&gt;&amp;nbsp;{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;double&lt;/span&gt;&amp;nbsp;actual&amp;nbsp;=&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;Statistics&lt;/span&gt;.mean(&lt;span style=&quot;color:blue;&quot;&gt;new&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;double&lt;/span&gt;[]&amp;nbsp;{&amp;nbsp;42.0&amp;nbsp;});
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;assertEquals(42.0,&amp;nbsp;actual);
}&lt;/pre&gt;
    &lt;/p&gt;
    &lt;p&gt;
        Instead of &apos;rethrowing&apos; checked exceptions, you may also handle them, if you can.
    &lt;/p&gt;
    &lt;h3 id=&quot;f2f5c2189839481b823dbdfde3a6de62&quot;&gt;
        Handling checked exceptions &lt;a href=&quot;#f2f5c2189839481b823dbdfde3a6de62&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        If you have a sensible way to deal with error values, you may handle checked exceptions. Let&apos;s assume, mostly to have an example to look at, that we also need a function to calculate the empirical &lt;a href=&quot;https://en.wikipedia.org/wiki/Variance&quot;&gt;variance&lt;/a&gt; of a data set. Furthermore, for the sole benefit of the example, let&apos;s handwave and say that if the data set is empty, this means that the variance is zero. (I &lt;em&gt;do&lt;/em&gt; understand that that&apos;s not how variance is defined, but work with me: It&apos;s only for the sake of the example.)
    &lt;/p&gt;
    &lt;p&gt;
        &lt;pre&gt;&lt;span style=&quot;color:blue;&quot;&gt;public&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;static&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;double&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;variance&lt;/span&gt;(&lt;span style=&quot;color:blue;&quot;&gt;double&lt;/span&gt;[]&amp;nbsp;values)&amp;nbsp;{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;try&lt;/span&gt;&amp;nbsp;{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;double&lt;/span&gt;&amp;nbsp;mean&amp;nbsp;=&amp;nbsp;mean(values);
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;double&lt;/span&gt;&amp;nbsp;sumOfSquares&amp;nbsp;=&amp;nbsp;0;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;for&lt;/span&gt;&amp;nbsp;(&lt;span style=&quot;color:blue;&quot;&gt;double&lt;/span&gt;&amp;nbsp;value&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;:&lt;/span&gt;&amp;nbsp;values)&amp;nbsp;{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;double&lt;/span&gt;&amp;nbsp;deviation&amp;nbsp;=&amp;nbsp;value&amp;nbsp;-&amp;nbsp;mean;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;sumOfSquares&amp;nbsp;+=&amp;nbsp;deviation&amp;nbsp;*&amp;nbsp;deviation;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;return&lt;/span&gt;&amp;nbsp;sumOfSquares&amp;nbsp;/&amp;nbsp;values.length;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;catch&lt;/span&gt;&amp;nbsp;(&lt;span style=&quot;color:blue;&quot;&gt;StatisticsException&lt;/span&gt;&amp;nbsp;e)&amp;nbsp;{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;return&lt;/span&gt;&amp;nbsp;0;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}
}&lt;/pre&gt;
    &lt;/p&gt;
    &lt;p&gt;
        Since the &lt;code&gt;variance&lt;/code&gt; function handles &lt;code&gt;StatisticsExceptions&lt;/code&gt; in a &lt;code&gt;try/catch&lt;/code&gt; construction, the function doesn&apos;t throw that exception, and therefore doesn&apos;t have to declare that it throws anything. To belabour the obvious: The method is &lt;em&gt;not&lt;/em&gt; adorned with any &lt;code&gt;throws StatisticsException&lt;/code&gt; declaration.
    &lt;/p&gt;
    &lt;h3 id=&quot;fe60742833bf4e37ac67ab91b9e507ba&quot;&gt;
        Refactoring to Result values &lt;a href=&quot;#fe60742833bf4e37ac67ab91b9e507ba&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        The claim in this article is that throwing exceptions is sufficiently equivalent to returning Result values that it warrants investigation. As far as I can tell, Java doesn&apos;t come with any built-in &lt;code&gt;Result&lt;/code&gt; type (and neither does C#), mostly, it seems, because Result values seem rather redundant in a language with checked exceptions.
    &lt;/p&gt;
    &lt;p&gt;
        Still, imagine that we define a &lt;a href=&quot;/2018/06/11/church-encoded-either&quot;&gt;Church-encoded Either&lt;/a&gt;, but call it &lt;code&gt;&lt;span style=&quot;color:#2b91af;&quot;&gt;Result&lt;/span&gt;&amp;lt;Succ,&amp;nbsp;Fail&amp;gt;&lt;/code&gt;. You can now refactor &lt;code&gt;mean&lt;/code&gt; to return a &lt;code&gt;Result&lt;/code&gt; value:
    &lt;/p&gt;
    &lt;p&gt;
        &lt;pre&gt;&lt;span style=&quot;color:blue;&quot;&gt;public&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;static&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;Result&amp;lt;Double,&amp;nbsp;StatisticsException&amp;gt;&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;mean&lt;/span&gt;(&lt;span style=&quot;color:blue;&quot;&gt;double&lt;/span&gt;[]&amp;nbsp;values)&amp;nbsp;{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;if&lt;/span&gt;&amp;nbsp;(values&amp;nbsp;==&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;null&lt;/span&gt;&amp;nbsp;||&amp;nbsp;values.length&amp;nbsp;==&amp;nbsp;0)&amp;nbsp;{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;return&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;Result&lt;/span&gt;.failure(&lt;span style=&quot;color:blue;&quot;&gt;new&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;StatisticsException&lt;/span&gt;(
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:#a31515;&quot;&gt;&amp;quot;The&amp;nbsp;parameter&amp;nbsp;&amp;#39;values&amp;#39;&amp;nbsp;must&amp;nbsp;not&amp;nbsp;be&amp;nbsp;null&amp;nbsp;or&amp;nbsp;empty.&amp;quot;&lt;/span&gt;));
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;double&lt;/span&gt;&amp;nbsp;sum&amp;nbsp;=&amp;nbsp;0;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;for&lt;/span&gt;&amp;nbsp;(&lt;span style=&quot;color:blue;&quot;&gt;double&lt;/span&gt;&amp;nbsp;value&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;:&lt;/span&gt;&amp;nbsp;values)&amp;nbsp;{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;sum&amp;nbsp;+=&amp;nbsp;value;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;return&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;Result&lt;/span&gt;.success(sum&amp;nbsp;/&amp;nbsp;values.length);
}&lt;/pre&gt;
    &lt;/p&gt;
    &lt;p&gt;
        In order to make the change as understandable as possible, I&apos;ve only changed the function to return a &lt;code&gt;Result&lt;/code&gt; value, while most other design choices remain as before. Particularly, the failure case contains &lt;code&gt;StatisticsException&lt;/code&gt;, although as a general rule, I&apos;d consider that an anti-pattern: &lt;a href=&quot;https://eiriktsarpalis.wordpress.com/2017/02/19/youre-better-off-using-exceptions/&quot;&gt;You&apos;re better off using exceptions&lt;/a&gt; if exceptions are what your are dealing with.
    &lt;/p&gt;
    &lt;p&gt;
        That said, the above variation of &lt;code&gt;mean&lt;/code&gt; no longer has to declare that it &lt;code&gt;throws StatisticsException&lt;/code&gt;, because it implicitly does that by its static return type.
    &lt;/p&gt;
    &lt;p&gt;
        Furthermore, &lt;code&gt;variance&lt;/code&gt; can still handle both success and failure cases with &lt;code&gt;match&lt;/code&gt;:
    &lt;/p&gt;
    &lt;p&gt;
        &lt;pre&gt;&lt;span style=&quot;color:blue;&quot;&gt;public&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;static&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;double&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;variance&lt;/span&gt;(&lt;span style=&quot;color:blue;&quot;&gt;double&lt;/span&gt;[]&amp;nbsp;values)&amp;nbsp;{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;return&lt;/span&gt;&amp;nbsp;mean(values).match(
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;mean&amp;nbsp;-&amp;gt;&amp;nbsp;{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;double&lt;/span&gt;&amp;nbsp;sumOfSquares&amp;nbsp;=&amp;nbsp;0;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;for&lt;/span&gt;&amp;nbsp;(&lt;span style=&quot;color:blue;&quot;&gt;double&lt;/span&gt;&amp;nbsp;value&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;:&lt;/span&gt;&amp;nbsp;values)&amp;nbsp;{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;double&lt;/span&gt;&amp;nbsp;deviation&amp;nbsp;=&amp;nbsp;value&amp;nbsp;-&amp;nbsp;mean;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;sumOfSquares&amp;nbsp;+=&amp;nbsp;deviation&amp;nbsp;*&amp;nbsp;deviation;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;return&lt;/span&gt;&amp;nbsp;sumOfSquares&amp;nbsp;/&amp;nbsp;values.length;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;},
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;error&amp;nbsp;-&amp;gt;&amp;nbsp;0.0
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;);
}&lt;/pre&gt;
    &lt;/p&gt;
    &lt;p&gt;
        Just like &lt;code&gt;try/catch&lt;/code&gt; enables you to &apos;escape&apos; having to propagate a checked exception, &lt;code&gt;match&lt;/code&gt; allows you to handle both cases of a &lt;a href=&quot;https://en.wikipedia.org/wiki/Tagged_union&quot;&gt;sum type&lt;/a&gt; in order to instead return an &apos;unwrapped&apos; value, like a &lt;code&gt;double&lt;/code&gt;.
    &lt;/p&gt;
    &lt;h3 id=&quot;8844ff0b0a3f459f9e110c54afcd47ba&quot;&gt;
        Not a true isomorphism &lt;a href=&quot;#8844ff0b0a3f459f9e110c54afcd47ba&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        Some languages (e.g. &lt;a href=&quot;https://fsharp.org/&quot;&gt;F#&lt;/a&gt; and &lt;a href=&quot;https://www.haskell.org/&quot;&gt;Haskell&lt;/a&gt;) already have built-in Result types (although they may instead be called &lt;code&gt;Either&lt;/code&gt;). In other languages, you can either find a reusable library that provides such a type, or you can add one yourself.
    &lt;/p&gt;
    &lt;p&gt;
        Once you have a Result type, you can always refactor exception-throwing code to Result-returning code. This applies even if the language in question doesn&apos;t have checked exceptions. In fact, I&apos;ve mostly performed this manoeuvre in C#, which doesn&apos;t have checked exceptions.
    &lt;/p&gt;
    &lt;p&gt;
        Most mainstream languages also support exceptions, so if you have a Result-valued method, you can also refactor the &apos;other way&apos;. For the above statistics example, you simply read the examples from bottom toward the top.
    &lt;/p&gt;
    &lt;p&gt;
        Because it&apos;s possible to go back and forth like that, this relationship looks like a software design isomorphism. It&apos;s not quite, however, since information is lost in both directions.
    &lt;/p&gt;
    &lt;p&gt;
        When you refactor from throwing an exception to returning a Result value, you lose the stack trace embedded in the exception. Additionally, languages that support exceptions have very specific semantics for that language construct. Specifically, an unhandled exception crashes its program, and although this may look catastrophic, it usually happens in an orderly way. The compiler or language runtime makes sure that the process exits with a proper error code. Usually, an unhandled exception is communicated to the operating system, which logs the error, including the stack trace. All of this happens automatically.
    &lt;/p&gt;
    &lt;p&gt;
        As &lt;a href=&quot;https://eiriktsarpalis.wordpress.com/2017/02/19/youre-better-off-using-exceptions/&quot;&gt;Eirik Tsarpalis points out&lt;/a&gt;, you lose all of this &apos;convenience&apos; if you instead use Result values. A Result is just another data structure, and the semantics associated with failure cases are entirely your responsibility. If you need an &apos;unhandled&apos; failure case to crash the program, you must explicitly write code to make the program return an error code to the operating system.
    &lt;/p&gt;
    &lt;p&gt;
        So why would you ever want to use Result types? Because you also, typically, lose information going from Result-valued operations to throwing exceptions.
    &lt;/p&gt;
    &lt;p&gt;
        Most importantly, you lose static type information about error conditions. Java is the odd man out in this respect, since checked exceptions actually &lt;em&gt;do&lt;/em&gt; statically advertise to callers the error cases with which they must deal. Even so, in the first example, above, &lt;code&gt;IllegalArgumentException&lt;/code&gt; is not part of the statically-typed method signature, since &lt;code&gt;IllegalArgumentException&lt;/code&gt; is not a checked exception. Consequently, I had to invent the custom &lt;code&gt;StatisticsException&lt;/code&gt; to make the example work. Other languages don&apos;t support checked exceptions, so there, a compiler or static analyser can&apos;t help you identify whether or not you&apos;ve dealt with all error cases.
    &lt;/p&gt;
    &lt;p&gt;
        Thus, in statically typed languages, a Result value contains information about error cases. A compiler or static analyser can check whether you&apos;ve dealt with all possible errors. If you refactor to throwing exceptions, this information is lost.
    &lt;/p&gt;
    &lt;p&gt;
        The bottom line is that you can refactor from exceptions to Results, or from Results to exceptions. As far as I can tell, these refactorings are always possible, but you gain and lose some capabilities in both directions.
    &lt;/p&gt;
    &lt;h3 id=&quot;90ea11bc449b4e93a9d167796f118cc3&quot;&gt;
        Other languages &lt;a href=&quot;#90ea11bc449b4e93a9d167796f118cc3&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        So far, I&apos;ve only shown a single example in Java. You can, however, easily do the same exercise in other languages that support exceptions. My article &lt;a href=&quot;/2020/02/03/non-exceptional-averages&quot;&gt;Non-exceptional averages&lt;/a&gt; goes over some of the same ground in C#, and &lt;a href=&quot;/2024/05/06/conservative-codomain-conjecture&quot;&gt;Conservative codomain conjecture&lt;/a&gt; expands on the &lt;em&gt;average&lt;/em&gt; example in both C# and F#.
    &lt;/p&gt;
    &lt;p&gt;
        You can even implement Result types in &lt;a href=&quot;https://www.python.org/&quot;&gt;Python&lt;/a&gt;; the reusable library &lt;a href=&quot;https://github.com/dry-python/returns&quot;&gt;returns&lt;/a&gt;, for example, comes with &lt;a href=&quot;/2022/04/25/the-maybe-monad&quot;&gt;Maybe&lt;/a&gt; and Result. Given that Python is fundamentally dynamically typed, however, I&apos;m not sure I&apos;m convinced of the utility of that.
    &lt;/p&gt;
    &lt;p&gt;
        At the other extreme, Haskell idiomatically uses &lt;code&gt;Either&lt;/code&gt; for most error handling. Even so, the language also has exceptions, and even if some may think that they&apos;re mostly present for historical reasons, they&apos;re still used in modern Haskell code to model &lt;a href=&quot;/2024/01/29/error-categories-and-category-errors&quot;&gt;predictable errors that you probably can&apos;t handle&lt;/a&gt;, such as various IO-related problems: The file is gone, the network is down, the database is not responding, etc.
    &lt;/p&gt;
    &lt;p&gt;
        Finally, we should note that the similarity between exceptions and Result values depends on the language in question. Some languages don&apos;t support &lt;a href=&quot;https://en.wikipedia.org/wiki/Parametric_polymorphism&quot;&gt;parametric polymorphism&lt;/a&gt; (AKA &lt;em&gt;generics&lt;/em&gt;), and while I haven&apos;t tried, I&apos;d expect the utility of Result values to be limited in those cases. On the other hand, some languages don&apos;t have exceptions, &lt;a href=&quot;https://en.wikipedia.org/wiki/C_(programming_language)&quot;&gt;C&lt;/a&gt; being perhaps the most notable example.
    &lt;/p&gt;
    &lt;h3 id=&quot;89c5ca8ff8e949fd85318d64c36cbabb&quot;&gt;
        Conclusion &lt;a href=&quot;#89c5ca8ff8e949fd85318d64c36cbabb&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        All programs can fail. Over the decades, various languages have had different approaches to error handling. Exceptions, including mechanisms for throwing and catching them, is perhaps the most common. Another strategy is to rely on Result values. In their given contexts, each offer benefits and drawbacks.
    &lt;/p&gt;
    &lt;p&gt;
        In many languages, you have a choice of both. In Haskell, Results (&lt;code&gt;Either&lt;/code&gt;) is the idiomatic solution, but exceptions are still possible. In C-like languages, ironically, exceptions are the norm, but in many (like Java and C#) you can bolt on Results if you so decide, although it&apos;s likely to alienate some developers. In a language like F#, both options are present at an almost equal proportion. I&apos;d consider it idiomatic to use &lt;a href=&quot;https://learn.microsoft.com/dotnet/fsharp/language-reference/results&quot;&gt;Result&lt;/a&gt; in &apos;native&apos; F# code, while when interoperating with the rest of the .NET ecosystem (which is almost exclusively written in C#) it may be more prudent to just stick to exceptions.
    &lt;/p&gt;
    &lt;p&gt;
        In those languages where you have both options, you can go back and forth between exceptions and Result values. Since you can refactor both ways, this relationship looks like a software design isomorphism. It isn&apos;t, though. There are differences in language semantics between the two, so a choice of one or the other has consequences. Recall, however, as &lt;a href=&quot;https://en.wikipedia.org/wiki/Jean-Paul_Sartre&quot;&gt;Sartre&lt;/a&gt; said, not making a choice is also making a choice.
    &lt;/p&gt;
    &lt;p&gt;
        &lt;strong&gt;Next:&lt;/strong&gt; &lt;a href=&quot;/2020/02/10/builder-isomorphisms&quot;&gt;Builder isomorphisms&lt;/a&gt;.
    &lt;/p&gt;
&lt;/div&gt;
&lt;div id=&quot;comments&quot;&gt;
    &lt;hr&gt;
    &lt;h2 id=&quot;comments-header&quot;&gt;
        Comments
    &lt;/h2&gt;
    &lt;div class=&quot;comment&quot; id=&quot;4a0723fd432d4b00889ade3dea8de8c3&quot;&gt;
        &lt;div class=&quot;comment-author&quot;&gt;&lt;a href=&quot;https://medium.com/@denis.bredikhin&quot;&gt;Denis Bredikhin&lt;/a&gt; &lt;a href=&quot;#4a0723fd432d4b00889ade3dea8de8c3&quot;&gt;#&lt;/a&gt;&lt;/div&gt;
        &lt;div class=&quot;comment-content&quot;&gt;
            &lt;p&gt;
                Thank you for the article  an interesting perspective on comparing exceptions and the Result pattern.
                I recently wrote an article where I explored specific scenarios in which the Result pattern offers advantages over exceptions, and vice versa.
                &lt;a href=&quot;https://medium.com/@denis.bredikhin/exception-handling-in-net-59123c36240a&quot;&gt;Exception Handling in .NET&lt;/a&gt;
                Id be very interested to hear your thoughts on it.
            &lt;/p&gt;
        &lt;/div&gt;
        &lt;div class=&quot;comment-date&quot;&gt;2025-10-17 08:34 UTC&lt;/div&gt;
    &lt;/div&gt;

    &lt;div class=&quot;comment&quot; id=&quot;dd40b4e5f049448e98b44069529b1650&quot;&gt;
        &lt;div class=&quot;comment-author&quot;&gt;&lt;a href=&quot;/&quot;&gt;Mark Seemann&lt;/a&gt; &lt;a href=&quot;#dd40b4e5f049448e98b44069529b1650&quot;&gt;#&lt;/a&gt;&lt;/div&gt;
        &lt;div class=&quot;comment-content&quot;&gt;
            &lt;p&gt;
                Thank you for writing. Proper exception-throwing and -handling is indeed complicated, and I can tell from your article that you&apos;ve seen many of the same antipatterns and much of the same cargo-cult programming that I have. Clearly, there&apos;s a need for content such as your article to educate people on better modelling of errors.
            &lt;/p&gt;
        &lt;/div&gt;
        &lt;div class=&quot;comment-date&quot;&gt;2025-10-22 05:49 UTC&lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;hr&gt;
      This blog is totally free, but if you like it, please consider &lt;a href="https://blog.ploeh.dk/support"&gt;supporting it&lt;/a&gt;.</description>
        <author>Mark Seemann</author>
        <guid isPermaLink="false">https://blog.ploeh.dk/2025/10/15/result-isomorphism</guid>
      </item>
    
      <item>
        <title>Shift left on x</title>
        <link>https://blog.ploeh.dk/2025/10/06/shift-left-on-x/</link>
        <pubDate>Mon, 06 Oct 2025 07:57:00 UTC</pubDate>
        <description>


&lt;div id=&quot;post&quot;&gt;
    &lt;p&gt;
        &lt;em&gt;A difficult task may be easier if done sooner.&lt;/em&gt;
    &lt;/p&gt;
    &lt;p&gt;
        You&apos;ve probably seen a figure like this before:
    &lt;/p&gt;
    &lt;p&gt;
        &lt;img src=&quot;/content/binary/continuous-cost-increse-over-time.png&quot; alt=&quot;Graph with time along the x-axis and cost on the y-axis. One curve goes from low cost to high cost as time increases.&quot;&gt;
    &lt;/p&gt;
    &lt;p&gt;
        The point is that as time passes, the cost of doing something increases. This is often used to explain why test-driven development (TDD) or other agile methods are cost-effective alternatives to a waterfall process.
    &lt;/p&gt;
    &lt;p&gt;
        Last time I checked, however, there was scant &lt;a href=&quot;/2020/05/25/wheres-the-science&quot;&gt;scientific evidence&lt;/a&gt; for this curve.
    &lt;/p&gt;
    &lt;p&gt;
        Even so, it &lt;em&gt;feels&lt;/em&gt; right. If you discover a bug while you write the code, it&apos;s much easier to fix it than if it&apos;s discovered weeks later.
    &lt;/p&gt;
    &lt;h3 id=&quot;3f639ac506f548949c588767f3860ec3&quot;&gt;
        Make security easier &lt;a href=&quot;#3f639ac506f548949c588767f3860ec3&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        I was recently reminded of the above curve because a customer of mine was struggling with security; mostly authentication and authorization. They asked me if there was a software-engineering practice that could help them get a better handle on security. Since this is a customer who&apos;s otherwise quite knowledgeable about agile methods and software engineering, I was a little surprised that they hadn&apos;t heard the phrase &lt;em&gt;shift left on security&lt;/em&gt;.
    &lt;/p&gt;
    &lt;p&gt;
        The idea fits with the above diagram. &apos;Shifting left&apos; implies moving to the left on the time axis. In other words, do things sooner. Specifically related to security, the idea is to include security concerns early in every software development process.
    &lt;/p&gt;
    &lt;p&gt;
        There&apos;s little new in this. &lt;a href=&quot;/ref/writing-secure-code-2e&quot;&gt;Writing Secure Code&lt;/a&gt; from 2004 describes how &lt;em&gt;threat modelling&lt;/em&gt; is part of secure coding practices. This is something I&apos;ve had in the back of my mind since reading the book. I also describe the technique and give an example in &lt;a href=&quot;/2021/06/14/new-book-code-that-fits-in-your-head&quot;&gt;Code That Fits in Your Head&lt;/a&gt;.
    &lt;/p&gt;
    &lt;p&gt;
        If I know that a system I&apos;m developing requires authentication, some of the first automated acceptance tests I write is one that successfully authenticates against the system, and one or more that fail to do so. Again, the code base that accompanies Code That Fits in Your Head has examples of this.
    &lt;/p&gt;
    &lt;p&gt;
        Since my customer&apos;s question reminded me of this practice, I began pondering the idea of &apos;shifting left&apos;. Since it&apos;s both touted as a benefit of TDD and DevSecOps, an obvious pattern suggests itself.
    &lt;/p&gt;
    &lt;h3 id=&quot;e23188bbc34f4a0099411bf059ed9d08&quot;&gt;
        Sufficient requirements &lt;a href=&quot;#e23188bbc34f4a0099411bf059ed9d08&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        It&apos;s been years since I last drew the above diagram. As I implied, one problem with it is that there seems to be little quantifiable evidence for that relationship. On the other hand, you&apos;ve surely had the experience that some tasks become harder, the longer you wait. I&apos;ll list some example later.
    &lt;/p&gt;
    &lt;p&gt;
        While we may not have solid scientific evidence that a cost curve looks like above, it doesn&apos;t have to look like that to make shifting left worthwhile. All it takes, really, is that the relationship is non-decreasing, and increases at least once. It doesn&apos;t have to be polynomial or exponential; it may be linear or logarithmic. It may even be a non-decreasing &lt;a href=&quot;https://en.wikipedia.org/wiki/Step_function&quot;&gt;step function&lt;/a&gt;, like this:
    &lt;/p&gt;
    &lt;p&gt;
        &lt;img src=&quot;/content/binary/stepwise-cost-increase-over-time.png&quot; alt=&quot;Graph with time along the x-axis and cost on the y-axis. A staircase-shaped figure indicates a stepwise increasing function.&quot;&gt;
    &lt;/p&gt;
    &lt;p&gt;
        This, as far as I can tell, is a sufficient condition to warrant shifting left on an activity. If you have even &lt;a href=&quot;https://martinfowler.com/bliki/AnecdotalEvidence.html&quot;&gt;anecdotal evidence&lt;/a&gt; that it may be more costly to postpone an activity, do it sooner. In practice, I don&apos;t think that you need to wait for solid scientific evidence before you do this.
    &lt;/p&gt;
    &lt;p&gt;
        While not quite the same, it&apos;s a notion similar to the old agile saw: &lt;em&gt;If it hurts, do it more often.&lt;/em&gt; Instead, we may phrase it as: &lt;em&gt;If it gets harder with time, do it sooner.&lt;/em&gt;
    &lt;/p&gt;
    &lt;h3 id=&quot;fb9cd07bc9174af39d7dd1be92289408&quot;&gt;
        Examples &lt;a href=&quot;#fb9cd07bc9174af39d7dd1be92289408&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        You&apos;ve already seen two examples: TDD and security. Are there other examples where tackling problems sooner may decrease cost? Certainly.
    &lt;/p&gt;
    &lt;p&gt;
        A few, I cover in &lt;a href=&quot;/code-that-fits-in-your-head&quot;&gt;Code That Fits in Your Head&lt;/a&gt;. The earlier you automate the build process, the easier it is. The earlier you treat all warnings as errors, the easier it is. This seems almost self-explanatory, particularly when it comes to treating warnings as errors. In a brand-new code base, you have no warnings. In that situation, treating warnings as errors is free. When, later, a compiler warning appears, your code doesn&apos;t compile, and you&apos;re forced to immediately deal with it. At that time, it tends to be much easier to fix the issue, because no other code depends on the code with the warning.
    &lt;/p&gt;
    &lt;p&gt;
        A similar situation applies to an automated build. At the beginning, an automated build is a simple batch file with one command. &lt;code&gt;dotnet test -c Release&lt;/code&gt;, &lt;code&gt;stack test&lt;/code&gt;, &lt;code&gt;py -m pytest&lt;/code&gt;, and so on. Later, when you need to deal with databases, security, third-party components, etc. you enhance the automated build &apos;just in time&apos;.
    &lt;/p&gt;
    &lt;p&gt;
        Once you have an automated build, deployment is a small step further. In the beginning, deploying an application is typically as easy as copying some program files (compiled code or source files, depending on language) to the machines on which it&apos;s going to run. An exception may be if the deployment target is some sort of app store, with a vetting process that prevents you from deploying a walking skeleton. If, on the other hand, your organization controls the deployment target, the sooner you deploy a hello-world application, the easier it is.
    &lt;/p&gt;
    &lt;p&gt;
        Yet another shift-left example is using static code analysis or &lt;a href=&quot;https://en.wikipedia.org/wiki/Lint_(software)&quot;&gt;linting&lt;/a&gt;, particularly when combined with treating warnings as errors. Linters are usually free, and as I describe in Code That Fits in Your Head, I&apos;ve always found it irrational that teams don&apos;t use them. Not that I don&apos;t understand the mechanism, because if you only turn them on at a time when the code base has already accumulated thousands of linter issues, the sheer volume is overwhelming.
    &lt;/p&gt;
    &lt;p&gt;
        Closely related to this discussion is the &lt;a href=&quot;/2023/01/23/agilean&quot;&gt;lean development notion that bugs are stop-the-line issues&lt;/a&gt;. The correct number of known bugs in the code base is zero. The correct number of unhandled exceptions in production is zero. This sounds unattainable to most people, but is possible if you shift left on managing defects.
    &lt;/p&gt;
    &lt;p&gt;
        In short:
    &lt;/p&gt;
    &lt;ul&gt;
        &lt;li&gt;Shift left on security&lt;/li&gt;
        &lt;li&gt;Shift left on testing&lt;/li&gt;
        &lt;li&gt;Shift left on treating warnings as errors&lt;/li&gt;
        &lt;li&gt;Shift left on automated builds&lt;/li&gt;
        &lt;li&gt;Shift left on deployment&lt;/li&gt;
        &lt;li&gt;Shift left on linting&lt;/li&gt;
        &lt;li&gt;Shift left on defect management&lt;/li&gt;
    &lt;/ul&gt;
    &lt;p&gt;
        This list is hardly exhaustive.
    &lt;/p&gt;
    &lt;h3 id=&quot;a20b501150c34db585453d9009f582db&quot;&gt;
        Shift right &lt;a href=&quot;#a20b501150c34db585453d9009f582db&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        While it increases your productivity to do some things sooner, it&apos;s not a universal rule. Some things &lt;a href=&quot;/2025/02/17/in-defence-of-multiple-wip&quot;&gt;become easier, the longer you wait&lt;/a&gt;. In terms of time-to-cost curves, this happens whenever the curve is decreasing, even if only step-wise.
    &lt;/p&gt;
    &lt;p&gt;
        &lt;img src=&quot;/content/binary/stepwise-cost-decrease-over-time.png&quot; alt=&quot;Graph with time along the x-axis and cost on the y-axis. A staircase-shaped figure indicates a stepwise decreasing function.&quot;&gt;
    &lt;/p&gt;
    &lt;p&gt;
        The danger of these figures is that they may give the impression of a deterministic process. That need not be the case, but if you have reason to believe that waiting until later may make solving a problem easier, consider waiting. The notion of waiting until &lt;a href=&quot;https://blog.codinghorror.com/the-last-responsible-moment/&quot;&gt;the last responsible moment&lt;/a&gt; is central to &lt;a href=&quot;/2023/01/23/agilean&quot;&gt;lean or agile software development&lt;/a&gt;.
    &lt;/p&gt;
    &lt;p&gt;
        In a sense, you could view this is &apos;shifting right&apos; on certain tasks. More than once I&apos;ve experienced that if you wait long enough with a certain task, it becomes irrelevant. Not just easier to perform, but something that you don&apos;t need to do at all. What looked like a requirement early on turned out to be not at all what the customer or user wanted, after all.
    &lt;/p&gt;
    &lt;h3 id=&quot;383b2c22a408406a91c17a11ed0bdbec&quot;&gt;
        When to do what &lt;a href=&quot;#383b2c22a408406a91c17a11ed0bdbec&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        How do you distinguish? How do you decide if shifting left or shifting right is more appropriate? In practice, it&apos;s rarely difficult. The shift-left list above contains the usual suspects. While the list may not be exhaustive, it&apos;s a well-known list of practices that countless teams have found easier to do sooner rather than later.
    &lt;/p&gt;
    &lt;p&gt;
        My own inclination would be to treat most other things as tasks that are better postponed. After all, you can&apos;t do &lt;em&gt;everything&lt;/em&gt; as the &lt;em&gt;first&lt;/em&gt; thing. Naturally, there has to be some sequencing of tasks.
    &lt;/p&gt;
    &lt;p&gt;
        Thinking about such decisions in terms of time-cost curves feels natural to me. I find it an easy framework to consider whether I should shift left or right on some activity.
    &lt;/p&gt;
    &lt;h3 id=&quot;e5d50d3f31474bae91782e6623a48a8f&quot;&gt;
        Conclusion &lt;a href=&quot;#e5d50d3f31474bae91782e6623a48a8f&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        Some things are easier if you get started as soon as possible. Candidates include testing, deployment, security, and defect management. This is the case when there&apos;s a increasing relationship between time and cost. This relationship need not be a quantified function. Often, you can get by with a sense that &apos;if I do this now, it&apos;s going to be easy; if I wait, it&apos;s going to be harder.&apos;
    &lt;/p&gt;
    &lt;p&gt;
        Conversely, some things are better postponed to the last responsible moment. This happens if the relation between time and cost is decreasing.
    &lt;/p&gt;
    &lt;p&gt;
        Perhaps we can simplify this analysis even further. Perhaps you don&apos;t even need to think of (step) functions. All you may need is to consider the &lt;a href=&quot;https://en.wikipedia.org/wiki/Partially_ordered_set&quot;&gt;partial order&lt;/a&gt; of tasks in terms of cost. Since I&apos;m a visual thinker, however, increasing and decreasing functions come more naturally to me.
    &lt;/p&gt;
&lt;/div&gt;&lt;hr&gt;
      This blog is totally free, but if you like it, please consider &lt;a href="https://blog.ploeh.dk/support"&gt;supporting it&lt;/a&gt;.</description>
        <author>Mark Seemann</author>
        <guid isPermaLink="false">https://blog.ploeh.dk/2025/10/06/shift-left-on-x</guid>
      </item>
    
      <item>
        <title>Composing pure Haskell assertions</title>
        <link>https://blog.ploeh.dk/2025/09/29/composing-pure-haskell-assertions/</link>
        <pubDate>Mon, 29 Sep 2025 07:43:00 UTC</pubDate>
        <description>


&lt;div id=&quot;post&quot;&gt;
    &lt;p&gt;
        &lt;em&gt;With HUnit and QuickCheck examples.&lt;/em&gt;
    &lt;/p&gt;
    &lt;p&gt;
        A question had been in the back of my mind for a long time, but I always got caught up in something seemingly more important, so I didn&apos;t get around to investigate until recently. It&apos;s simply this:
    &lt;/p&gt;
    &lt;p&gt;
        How do you compose &lt;a href=&quot;https://en.wikipedia.org/wiki/Pure_function&quot;&gt;pure&lt;/a&gt; assertions in &lt;a href=&quot;https://hackage.haskell.org/package/HUnit/docs/Test-HUnit.html&quot;&gt;HUnit&lt;/a&gt; or &lt;a href=&quot;https://hackage-content.haskell.org/package/QuickCheck/docs/Test-QuickCheck.html&quot;&gt;QuickCheck&lt;/a&gt;?
    &lt;/p&gt;
    &lt;p&gt;
        Let me explain what I mean, and why this isn&apos;t quite as straightforward as it may sound.
    &lt;/p&gt;
    &lt;h3 id=&quot;76d1bda9793e4f5c810f387c09fc8324&quot;&gt;
        Assertions as statements &lt;a href=&quot;#76d1bda9793e4f5c810f387c09fc8324&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        What do I mean by &lt;em&gt;composing&lt;/em&gt; assertions? Really nothing more than wanting to verify more than a single outcome of a test.
    &lt;/p&gt;
    &lt;p&gt;
        If you&apos;re used to writing test assertions in imperative languages like C#, &lt;a href=&quot;https://www.java.com/&quot;&gt;Java&lt;/a&gt;, &lt;a href=&quot;https://www.python.org/&quot;&gt;Python&lt;/a&gt;, or JavaScript, you think nothing of it. Just write an assertion on one line, and the next assertion on the next line.
    &lt;/p&gt;
    &lt;p&gt;
        If you&apos;re writing impure &lt;a href=&quot;https://www.haskell.org/&quot;&gt;Haskell&lt;/a&gt;, you can also do that.
    &lt;/p&gt;
    &lt;p&gt;
        &lt;pre&gt;&lt;span style=&quot;color:#a31515;&quot;&gt;&amp;quot;CLRS&amp;nbsp;example&amp;quot;&lt;/span&gt;&amp;nbsp;~:&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;do&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;p&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;::&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;IOArray&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Int&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Int&lt;/span&gt;&amp;nbsp;&amp;lt;-
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;newListArray&amp;nbsp;(1,&amp;nbsp;10)&amp;nbsp;[1,&amp;nbsp;5,&amp;nbsp;8,&amp;nbsp;9,&amp;nbsp;10,&amp;nbsp;17,&amp;nbsp;17,&amp;nbsp;20,&amp;nbsp;24,&amp;nbsp;30]
 
&amp;nbsp;&amp;nbsp;(r,&amp;nbsp;s)&amp;nbsp;&amp;lt;-&amp;nbsp;cutRod&amp;nbsp;p&amp;nbsp;10
&amp;nbsp;&amp;nbsp;actualRevenue&amp;nbsp;&amp;lt;-&amp;nbsp;getElems&amp;nbsp;r
&amp;nbsp;&amp;nbsp;actualSizes&amp;nbsp;&amp;lt;-&amp;nbsp;getElems&amp;nbsp;s
 
&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;let&lt;/span&gt;&amp;nbsp;expectedRevenue&amp;nbsp;=&amp;nbsp;[0,&amp;nbsp;1,&amp;nbsp;5,&amp;nbsp;8,&amp;nbsp;10,&amp;nbsp;13,&amp;nbsp;17,&amp;nbsp;18,&amp;nbsp;22,&amp;nbsp;25,&amp;nbsp;30]
&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;let&lt;/span&gt;&amp;nbsp;expectedSizes&amp;nbsp;=&amp;nbsp;[1,&amp;nbsp;2,&amp;nbsp;3,&amp;nbsp;2,&amp;nbsp;2,&amp;nbsp;6,&amp;nbsp;1,&amp;nbsp;2,&amp;nbsp;3,&amp;nbsp;10]
&amp;nbsp;&amp;nbsp;expectedRevenue&amp;nbsp;@=?&amp;nbsp;actualRevenue
&amp;nbsp;&amp;nbsp;expectedSizes&amp;nbsp;@=?&amp;nbsp;actualSizes&lt;/pre&gt;
    &lt;/p&gt;
    &lt;p&gt;
        This example is an &lt;a href=&quot;/2018/05/07/inlined-hunit-test-lists&quot;&gt;inlined HUnit test&lt;/a&gt; which tests the &lt;a href=&quot;/2025/09/08/io-is-special&quot;&gt;impure cutRod variation&lt;/a&gt;. The two final statements are assertions that use the &lt;a href=&quot;https://hackage.haskell.org/package/HUnit/docs/Test-HUnit-Base.html#v:-64--61--63-&quot;&gt;@=?&lt;/a&gt; assertion operator. The value on the left side is the expected value, and to the right goes the actual value. This operator returns a type called &lt;code&gt;Assertion&lt;/code&gt;, which &lt;a href=&quot;https://hackage.haskell.org/package/HUnit/docs/Test-HUnit-Base.html#t:Assertion&quot;&gt;turns out&lt;/a&gt; to be nothing but an alias for &lt;code&gt;IO ()&lt;/code&gt;.
    &lt;/p&gt;
    &lt;p&gt;
        In other words, those assertions are impure actions, and they work similarly to assertions in imperative languages. If the actual value passes the assertion, nothing happens and execution moves on to the assertion on the next line. If, on the other hand, the assertion fails, execution short-circuits, and an error is reported.
    &lt;/p&gt;
    &lt;p&gt;
        Imperative languages typically throw exceptions to achieve that behaviour. Even &lt;a href=&quot;https://github.com/SwensenSoftware/unquote&quot;&gt;Unquote&lt;/a&gt; does this. Exactly how HUnit does it I don&apos;t know; I haven&apos;t looked under the hood.
    &lt;/p&gt;
    &lt;p&gt;
        You can do the same with &lt;a href=&quot;https://hackage-content.haskell.org/package/QuickCheck/docs/Test-QuickCheck-Monadic.html&quot;&gt;Test.QuickCheck.Monadic&lt;/a&gt;:
    &lt;/p&gt;
    &lt;p&gt;
        &lt;pre&gt;testProperty&amp;nbsp;&lt;span style=&quot;color:#a31515;&quot;&gt;&amp;quot;cutRod&amp;nbsp;returns&amp;nbsp;correct&amp;nbsp;arrays&amp;quot;&lt;/span&gt;&amp;nbsp;$&amp;nbsp;\&amp;nbsp;p&amp;nbsp;-&amp;gt;&amp;nbsp;monadicIO&amp;nbsp;$&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;do&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;let&lt;/span&gt;&amp;nbsp;n&amp;nbsp;=&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;length&lt;/span&gt;&amp;nbsp;p
&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;p&amp;#39;&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;::&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;IOArray&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Int&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Int&lt;/span&gt;&amp;nbsp;&amp;lt;-&amp;nbsp;run&amp;nbsp;$&amp;nbsp;newListArray&amp;nbsp;(1,&amp;nbsp;n)&amp;nbsp;p
 
&amp;nbsp;&amp;nbsp;(r,&amp;nbsp;s)&amp;nbsp;::&amp;nbsp;(IOArray&amp;nbsp;Int&amp;nbsp;Int,&amp;nbsp;IOArray&amp;nbsp;Int&amp;nbsp;Int)&amp;nbsp;&amp;lt;-&amp;nbsp;run&amp;nbsp;$&amp;nbsp;cutRod&amp;nbsp;p&amp;#39;&amp;nbsp;n
&amp;nbsp;&amp;nbsp;actualRevenue&amp;nbsp;&amp;lt;-&amp;nbsp;run&amp;nbsp;$&amp;nbsp;getElems&amp;nbsp;r
&amp;nbsp;&amp;nbsp;actualSizes&amp;nbsp;&amp;lt;-&amp;nbsp;run&amp;nbsp;$&amp;nbsp;getElems&amp;nbsp;s
 
&amp;nbsp;&amp;nbsp;assertWith&amp;nbsp;(&lt;span style=&quot;color:blue;&quot;&gt;length&lt;/span&gt;&amp;nbsp;actualRevenue&amp;nbsp;==&amp;nbsp;n&amp;nbsp;+&amp;nbsp;1)&amp;nbsp;&lt;span style=&quot;color:#a31515;&quot;&gt;&amp;quot;Revenue&amp;nbsp;length&amp;nbsp;is&amp;nbsp;incorrect&amp;quot;&lt;/span&gt;
&amp;nbsp;&amp;nbsp;assertWith&amp;nbsp;(&lt;span style=&quot;color:blue;&quot;&gt;length&lt;/span&gt;&amp;nbsp;actualSizes&amp;nbsp;==&amp;nbsp;n)&amp;nbsp;&lt;span style=&quot;color:#a31515;&quot;&gt;&amp;quot;Size&amp;nbsp;length&amp;nbsp;is&amp;nbsp;incorrect&amp;quot;&lt;/span&gt;
&amp;nbsp;&amp;nbsp;assertWith&amp;nbsp;(&lt;span style=&quot;color:blue;&quot;&gt;all&lt;/span&gt;&amp;nbsp;(\i&amp;nbsp;-&amp;gt;&amp;nbsp;0&amp;nbsp;&amp;lt;=&amp;nbsp;i&amp;nbsp;&amp;amp;&amp;amp;&amp;nbsp;i&amp;nbsp;&amp;lt;=&amp;nbsp;n)&amp;nbsp;actualSizes)&amp;nbsp;&lt;span style=&quot;color:#a31515;&quot;&gt;&amp;quot;Sizes&amp;nbsp;are&amp;nbsp;not&amp;nbsp;all&amp;nbsp;in&amp;nbsp;[1..n]&amp;quot;&lt;/span&gt;&lt;/pre&gt;
    &lt;/p&gt;
    &lt;p&gt;
        Like the previous example, you can repeatedly call &lt;code&gt;assertWith&lt;/code&gt;, since this action, too, is a statement that returns no value.
    &lt;/p&gt;
    &lt;p&gt;
        So far, so good.
    &lt;/p&gt;
    &lt;h3 id=&quot;7321a1e253aa47b9a005ffc313729bf2&quot;&gt;
        Composing assertions &lt;a href=&quot;#7321a1e253aa47b9a005ffc313729bf2&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        What if, however, you want to write tests as pure functions?
    &lt;/p&gt;
    &lt;p&gt;
        Pure functions are composed from expressions, while statements aren&apos;t allowed (or, at least, ineffective, and subject to be optimized away by a compiler). In other words, the above strategy isn&apos;t going to work. If you want to write more than one assertion, you need to figure out how they compose.
    &lt;/p&gt;
    &lt;p&gt;
        The naive answer might be to use &lt;a href=&quot;https://en.wikipedia.org/wiki/Logical_conjunction&quot;&gt;logical conjunction&lt;/a&gt; (AKA Boolean &lt;em&gt;and&lt;/em&gt;). Write one assertion as a Boolean expression, another assertion as another Boolean expression, and just compose them using the standard &apos;and&apos; operator. In Haskell, that would be &lt;code&gt;&amp;&amp;&lt;/code&gt;.
    &lt;/p&gt;
    &lt;p&gt;
        This works to a fashion, but has a major drawback. If such a composed assertion fails, it doesn&apos;t tell you why. All you know is that the entire Boolean expression evaluated to &lt;code&gt;False&lt;/code&gt;.
    &lt;/p&gt;
    &lt;p&gt;
        This is the reason that most testing libraries come with explicit assertion APIs. In HUnit, you may wish to use the &lt;a href=&quot;https://hackage.haskell.org/package/HUnit/docs/Test-HUnit-Base.html#v:-126--61--63-&quot;&gt;~=?&lt;/a&gt; operator, and in QuickCheck the &lt;a href=&quot;https://hackage-content.haskell.org/package/QuickCheck/docs/Test-QuickCheck.html#v:-61--61--61-&quot;&gt;===&lt;/a&gt; operator.
    &lt;/p&gt;
    &lt;p&gt;
        The question, however, is how they compose. Ideally, &lt;a href=&quot;/2022/11/07/applicative-assertions&quot;&gt;assertions should compose applicatively&lt;/a&gt;, but I&apos;ve never seen that in the wild. If not, look for a &lt;a href=&quot;/2017/10/06/monoids&quot;&gt;monoid&lt;/a&gt;, or at least a &lt;a href=&quot;/2017/11/27/semigroups&quot;&gt;semigroup&lt;/a&gt;.
    &lt;/p&gt;
    &lt;p&gt;
        Let&apos;s do that for both HUnit and QuickCheck.
    &lt;/p&gt;
    &lt;h3 id=&quot;5e1c9efb4ff841d8a588e01920eab8d2&quot;&gt;
        Composing HUnit assertions &lt;a href=&quot;#5e1c9efb4ff841d8a588e01920eab8d2&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        My favourite HUnit assertion is the &lt;code&gt;~=?&lt;/code&gt; operator, which has the (simplified) type &lt;code&gt;a &amp;gt; a -&amp;gt; Test&lt;/code&gt;. In other words, an expression like &lt;code&gt;expectedRevenue&amp;nbsp;~=?&amp;nbsp;actualRevenue&lt;/code&gt; has the type &lt;code&gt;Test&lt;/code&gt;. The question, then, is: How does &lt;code&gt;Test&lt;/code&gt; compose?
    &lt;/p&gt;
    &lt;p&gt;
        Not &lt;em&gt;that&lt;/em&gt; well, I&apos;m afraid, but I find the following workable. You can compose one or more &lt;code&gt;Test&lt;/code&gt; values with the &lt;a href=&quot;https://hackage.haskell.org/package/HUnit/docs/Test-HUnit-Base.html#v:TestList&quot;&gt;TestList&lt;/a&gt; constructor, but if you&apos;re already using the &lt;a href=&quot;https://hackage.haskell.org/package/HUnit/docs/Test-HUnit-Base.html#v:-126-:&quot;&gt;~:&lt;/a&gt; operator, as I usually do (see below), then you just need a &lt;code&gt;Testable&lt;/code&gt; instance, and it turns out that a list of &lt;code&gt;Testable&lt;/code&gt; values is itself a &lt;code&gt;Testable&lt;/code&gt; instance. This means that you can write a pure unit test and compose &lt;code&gt;~=?&lt;/code&gt; like this:
    &lt;/p&gt;
    &lt;p&gt;
        &lt;pre&gt;&lt;span style=&quot;color:#a31515;&quot;&gt;&amp;quot;CLRS&amp;nbsp;example&amp;quot;&lt;/span&gt;&amp;nbsp;~:
&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;let&lt;/span&gt;&amp;nbsp;p&amp;nbsp;=&amp;nbsp;[0,&amp;nbsp;1,&amp;nbsp;5,&amp;nbsp;8,&amp;nbsp;9,&amp;nbsp;10,&amp;nbsp;17,&amp;nbsp;17,&amp;nbsp;20,&amp;nbsp;24,&amp;nbsp;30]&amp;nbsp;::&amp;nbsp;[Int]
 
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;(r,&amp;nbsp;s)&amp;nbsp;=&amp;nbsp;cutRod&amp;nbsp;p&amp;nbsp;10
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;actualRevenue&amp;nbsp;=&amp;nbsp;Map.elems&amp;nbsp;r
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;actualSizes&amp;nbsp;=&amp;nbsp;Map.elems&amp;nbsp;s
 
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;expectedRevenue&amp;nbsp;=&amp;nbsp;[0,&amp;nbsp;1,&amp;nbsp;5,&amp;nbsp;8,&amp;nbsp;10,&amp;nbsp;13,&amp;nbsp;17,&amp;nbsp;18,&amp;nbsp;22,&amp;nbsp;25,&amp;nbsp;30]
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;expectedSizes&amp;nbsp;=&amp;nbsp;[1,&amp;nbsp;2,&amp;nbsp;3,&amp;nbsp;2,&amp;nbsp;2,&amp;nbsp;6,&amp;nbsp;1,&amp;nbsp;2,&amp;nbsp;3,&amp;nbsp;10]
&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;in&lt;/span&gt;&amp;nbsp;[expectedRevenue&amp;nbsp;~=?&amp;nbsp;actualRevenue,
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;expectedSizes&amp;nbsp;~=?&amp;nbsp;actualSizes]&lt;/pre&gt;
    &lt;/p&gt;
    &lt;p&gt;
        This is a refactoring of the above test, now as a pure function, because it tests the pure variation of &lt;code&gt;cutRod&lt;/code&gt;. Notice that the two assertions are simply returned as a list.
    &lt;/p&gt;
    &lt;p&gt;
        While this has enough syntactical elegance to satisfy me, it does have the disadvantage that it actually creates &lt;em&gt;two&lt;/em&gt; test cases. One that runs with the first assertion, and one that executes with the second:
    &lt;/p&gt;
    &lt;p&gt;
        &lt;pre&gt;:CLRS example:
  : [&lt;span style=&quot;color: green;&quot;&gt;OK&lt;/span&gt;]
  : [&lt;span style=&quot;color: green;&quot;&gt;OK&lt;/span&gt;]&lt;/pre&gt;
    &lt;/p&gt;
    &lt;p&gt;
        In most cases this is unlikely to be a problem, but it could be if the test performs a resource-intensive computation. Each assertion you add makes it run one more time.
    &lt;/p&gt;
    &lt;p&gt;
        A test like the one shown here is so &apos;small&apos; that this is rarely much of an issue. On the other hand, a property-based testing library might stress a System Under Test more, so fortunately, QuickCheck assertions compose better than HUnit assertions.
    &lt;/p&gt;
    &lt;h3 id=&quot;63d7b7bb1e7a4155afe8f318c5f91fb5&quot;&gt;
        Composing QuickCheck assertions &lt;a href=&quot;#63d7b7bb1e7a4155afe8f318c5f91fb5&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        The &lt;code&gt;===&lt;/code&gt; operator has the (simplified) type &lt;code&gt;a -&amp;gt; a -&amp;gt; Property&lt;/code&gt;. &lt;a href=&quot;https://hoogle.haskell.org/&quot;&gt;Hoogling&lt;/a&gt; for a combinator with the type &lt;code&gt;Property -&amp;gt; Property -&amp;gt; Property&lt;/code&gt; doesn&apos;t reveal anything useful, but fortunately it turns out that for running QuickCheck properties, all you really need is a &lt;code&gt;Testable&lt;/code&gt; instance (not the same &lt;code&gt;Testable&lt;/code&gt; as HUnit defines). And lo and behold! The &lt;a href=&quot;https://hackage-content.haskell.org/package/QuickCheck/docs/Test-QuickCheck.html#v:.-38--38-.&quot;&gt;.&amp;amp;&amp;amp;.&lt;/a&gt; operator is just what we need. That, or the &lt;a href=&quot;https://hackage-content.haskell.org/package/QuickCheck/docs/Test-QuickCheck.html#v:conjoin&quot;&gt;conjoin&lt;/a&gt; function, if you have more than two assertions to combine, as in this example:
    &lt;/p&gt;
    &lt;p&gt;
        &lt;pre&gt;testProperty&amp;nbsp;&lt;span style=&quot;color:#a31515;&quot;&gt;&amp;quot;cutRod&amp;nbsp;returns&amp;nbsp;correct&amp;nbsp;arrays&amp;quot;&lt;/span&gt;&amp;nbsp;$&amp;nbsp;\&amp;nbsp;p&amp;nbsp;-&amp;gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;do&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;let&lt;/span&gt;&amp;nbsp;n&amp;nbsp;=&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;length&lt;/span&gt;&amp;nbsp;p
&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;let&lt;/span&gt;&amp;nbsp;p&amp;#39;&amp;nbsp;=&amp;nbsp;0&amp;nbsp;:&amp;nbsp;p&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:green;&quot;&gt;--&amp;nbsp;Ensure&amp;nbsp;the&amp;nbsp;first&amp;nbsp;element&amp;nbsp;is&amp;nbsp;0
&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;let&lt;/span&gt;&amp;nbsp;(r,&amp;nbsp;s)&amp;nbsp;::&amp;nbsp;(Map&amp;nbsp;Int&amp;nbsp;Int,&amp;nbsp;Map&amp;nbsp;Int&amp;nbsp;Int)&amp;nbsp;=&amp;nbsp;cutRod&amp;nbsp;p&amp;#39;&amp;nbsp;n
&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;let&lt;/span&gt;&amp;nbsp;actualRevenue&amp;nbsp;=&amp;nbsp;Map.elems&amp;nbsp;r
&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;let&lt;/span&gt;&amp;nbsp;actualSizes&amp;nbsp;=&amp;nbsp;Map.elems&amp;nbsp;s
 
&amp;nbsp;&amp;nbsp;conjoin&amp;nbsp;[
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;length&lt;/span&gt;&amp;nbsp;actualRevenue&amp;nbsp;===&amp;nbsp;n&amp;nbsp;+&amp;nbsp;1,
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;length&lt;/span&gt;&amp;nbsp;actualSizes&amp;nbsp;===&amp;nbsp;n,
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;counterexample&amp;nbsp;&lt;span style=&quot;color:#a31515;&quot;&gt;&amp;quot;Sizes&amp;nbsp;are&amp;nbsp;not&amp;nbsp;all&amp;nbsp;in&amp;nbsp;[0..n]&amp;quot;&lt;/span&gt;&amp;nbsp;$
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;all&lt;/span&gt;&amp;nbsp;(\i&amp;nbsp;-&amp;gt;&amp;nbsp;0&amp;nbsp;&amp;lt;=&amp;nbsp;i&amp;nbsp;&amp;amp;&amp;amp;&amp;nbsp;i&amp;nbsp;&amp;lt;=&amp;nbsp;n)&amp;nbsp;actualSizes&amp;nbsp;]&lt;/pre&gt;
    &lt;/p&gt;
    &lt;p&gt;
        The &lt;code&gt;.&amp;amp;&amp;amp;.&lt;/code&gt; operator is actually a bit more flexible than &lt;code&gt;conjoin&lt;/code&gt;, but due to operator precedence and indentation rules, trying to chain those three assertions with &lt;code&gt;.&amp;amp;&amp;amp;.&lt;/code&gt; is less elegant than using &lt;code&gt;conjoin&lt;/code&gt;. In this case.
    &lt;/p&gt;
    &lt;h3 id=&quot;4d2bfeaad380487196478b194c9b840c&quot;&gt;
        Conclusion &lt;a href=&quot;#4d2bfeaad380487196478b194c9b840c&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        In imperative languages, composing test assertions is as simple as writing one assertion after another. Since assertions are statements, and imperative languages allow you to sequence statements, this is such a trivial way to compose assertions that you&apos;ve probably never given it much thought.
    &lt;/p&gt;
    &lt;p&gt;
        Pure programs, however, are not composed from statements, but rather from expressions. A pure assertion is an expression that returns a value, so if you want to compose two or more pure assertions, you need to figure out how to compose the values that the assertions return.
    &lt;/p&gt;
    &lt;p&gt;
        Ideally, assertions should compose as &lt;a href=&quot;/2018/10/01/applicative-functors&quot;&gt;applicative functors&lt;/a&gt;, but they rarely do. Instead, you&apos;ll have to go looking for combinators that enable you to combine two or more of a test library&apos;s built-in assertions. In this article, you&apos;ve seen how to compose assertions in HUnit and QuickCheck.
    &lt;/p&gt;
&lt;/div&gt;&lt;hr&gt;
      This blog is totally free, but if you like it, please consider &lt;a href="https://blog.ploeh.dk/support"&gt;supporting it&lt;/a&gt;.</description>
        <author>Mark Seemann</author>
        <guid isPermaLink="false">https://blog.ploeh.dk/2025/09/29/composing-pure-haskell-assertions</guid>
      </item>
    
      <item>
        <title>It's striking so quickly the industry forgets that lines of code isn't a measure of productivity</title>
        <link>https://blog.ploeh.dk/2025/09/22/its-striking-so-quickly-the-industry-forgets-that-lines-of-code-isnt-a-measure-of-productivity/</link>
        <pubDate>Mon, 22 Sep 2025 06:52:00 UTC</pubDate>
        <description>


&lt;div id=&quot;post&quot;&gt;
    &lt;p&gt;
        &lt;em&gt;Code is a liability, not an asset.&lt;/em&gt;
    &lt;/p&gt;
    &lt;p&gt;
        It&apos;s not a new idea that the more source code you have, the greater the maintenance burden. Dijkstra already touched on this topic in his Turing Award lecture in 1972, and later wrote,
    &lt;/p&gt;
    &lt;blockquote&gt;
        &lt;p&gt;
            &quot;if we wish to count lines of code, we should not regard them as &quot;lines produced&quot; but as &quot;lines spent&quot;&quot;
        &lt;/p&gt;
        &lt;footer&gt;&lt;cite&gt;On the cruelty of really teaching computing science&lt;/cite&gt;, Edsger W. Dijkstra, 1988&lt;/footer&gt;
    &lt;/blockquote&gt;
    &lt;p&gt;
        He went on to note that
    &lt;/p&gt;
    &lt;blockquote&gt;
        &lt;p&gt;
            &quot;the current conventional wisdom is so foolish as to book that count on the wrong side of the ledger.&quot;
        &lt;/p&gt;
        &lt;footer&gt;&lt;cite&gt;On the cruelty of really teaching computing science&lt;/cite&gt;, Edsger W. Dijkstra, 1988&lt;/footer&gt;
    &lt;/blockquote&gt;
    &lt;p&gt;
        The use of the word &lt;em&gt;ledger&lt;/em&gt; suggests an accounting perspective that was later also adopted by Tim Ottinger, who observed that &lt;a href=&quot;https://blog.objectmentor.com/articles/2007/04/16/code-is-a-liability&quot;&gt;Code is a Liability&lt;/a&gt;.
    &lt;/p&gt;
    &lt;p&gt;
        The entire premise of my book &lt;a href=&quot;/2021/06/14/new-book-code-that-fits-in-your-head&quot;&gt;Code That Fits in Your Head&lt;/a&gt; is also that the more code you have, the harder it becomes to evolve and maintain the code base.
    &lt;/p&gt;
    &lt;p&gt;
        Even so, it seems to me that, once more, most of the software industry is equating the ability to spew out as much code as fast as possible with productivity. My guess is that some people are in for a rude awakening in a couple of years.
    &lt;/p&gt;
&lt;/div&gt;&lt;hr&gt;
      This blog is totally free, but if you like it, please consider &lt;a href="https://blog.ploeh.dk/support"&gt;supporting it&lt;/a&gt;.</description>
        <author>Mark Seemann</author>
        <guid isPermaLink="false">https://blog.ploeh.dk/2025/09/22/its-striking-so-quickly-the-industry-forgets-that-lines-of-code-isnt-a-measure-of-productivity</guid>
      </item>
    
      <item>
        <title>Greyscale-box test-driven development</title>
        <link>https://blog.ploeh.dk/2025/09/15/greyscale-box-test-driven-development/</link>
        <pubDate>Mon, 15 Sep 2025 18:45:00 UTC</pubDate>
        <description>


&lt;div id=&quot;post&quot;&gt;
    &lt;p&gt;
        &lt;em&gt;Is TDD white-box testing or black-box testing?&lt;/em&gt;
    &lt;/p&gt;
    &lt;p&gt;
        Surely you&apos;re aware of the terms &lt;a href=&quot;https://en.wikipedia.org/wiki/Black-box_testing&quot;&gt;black-box testing&lt;/a&gt; and &lt;a href=&quot;https://en.wikipedia.org/wiki/White-box_testing&quot;&gt;white-box testing&lt;/a&gt;, but have you ever wondered where test-driven development (TDD) fits in that picture?
    &lt;/p&gt;
    &lt;p&gt;
        The short answer is that TDD as a software development practice sits somewhere between the two. It really isn&apos;t black and white, and exactly where TDD sits on the spectrum changes with circumstances.
    &lt;/p&gt;
    &lt;p&gt;
        &lt;img src=&quot;/content/binary/greyscale-tdd-spectrum.png&quot; alt=&quot;Black-box testing to the left, white-box testing to the right, with four grey boxes of varying greyscales in between, all four labeled TDD.&quot;&gt;
    &lt;/p&gt;
    &lt;p&gt;
        If the above diagram indicates that TDD can&apos;t occupy the space of undiluted black- or white-box testing, that&apos;s not my intent. In my experience, however, you rarely do neither when you engage with the TDD process. Rather, you find yourself somewhere in-between.
    &lt;/p&gt;
    &lt;p&gt;
        In the following, I&apos;ll examine the two extremes in order to explain why TDD rarely leads to either, starting with black-box testing.
    &lt;/p&gt;
    &lt;h3 id=&quot;7b6ff977cede461f9c859e55e2aa24c9&quot;&gt;
        Compartmentalization of knowledge &lt;a href=&quot;#7b6ff977cede461f9c859e55e2aa24c9&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        If you follow the usual &lt;a href=&quot;/2019/10/21/a-red-green-refactor-checklist&quot;&gt;red-green-refactor&lt;/a&gt; checklist, you write test code and production code in tight loops. You write some test code, some production code, more test code, then more production code, and so on.
    &lt;/p&gt;
    &lt;p&gt;
        If you&apos;re working by yourself, at least, that makes it almost impossible to treat the System Under Test (SUT) as a black box. After all, you&apos;re also the one who writes the production code.
    &lt;/p&gt;
    &lt;p&gt;
        You can try to &apos;forget&apos; the production code you just wrote whenever you circle back to writing another test, but in practice, you can&apos;t. Even so, it may still be a useful &lt;a href=&quot;/2020/01/13/on-doing-katas&quot;&gt;exercise&lt;/a&gt;. I call this technique &lt;em&gt;Gollum style&lt;/em&gt; (originally introduced in the Pluralsight course &lt;a href=&quot;/outside-in-tdd&quot;&gt;Outside-In Test-Driven Development&lt;/a&gt; as a variation on the &lt;a href=&quot;/2019/10/07/devils-advocate&quot;&gt;Devil&apos;s advocate&lt;/a&gt; technique). The idea is to assume two roles, and to explicitly distinguish the goals of the tester from the aims of the implementer.
    &lt;/p&gt;
    &lt;p&gt;
        Still, while this can be an illuminating exercise, I don&apos;t pretend that this is truly black-box testing.
    &lt;/p&gt;
    &lt;h3 id=&quot;6c9dfbef5e974355802d4548b0d6e146&quot;&gt;
        Pair programming &lt;a href=&quot;#6c9dfbef5e974355802d4548b0d6e146&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        If you pair-program, you have better options. You &lt;em&gt;could&lt;/em&gt; have one person write a test, and another person implement the code to pass the test. I could imagine a setup where the tester can&apos;t see the production code. Although I&apos;ve never seen or heard about anyone doing that, this would get close to true black-box TDD.
    &lt;/p&gt;
    &lt;p&gt;
        To demonstrate, imagine a team doing the &lt;a href=&quot;https://codingdojo.org/kata/FizzBuzz/&quot;&gt;FizzBuzz kata&lt;/a&gt; in this way. The tester writes the first test:
    &lt;/p&gt;
    &lt;p&gt;
        &lt;pre&gt;[&lt;span style=&quot;color:#2b91af;&quot;&gt;Fact&lt;/span&gt;]
&lt;span style=&quot;color:blue;&quot;&gt;public&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;void&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;One&lt;/span&gt;()
{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;var&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;actual&lt;/span&gt;&amp;nbsp;=&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;FizzBuzzer&lt;/span&gt;.&lt;span style=&quot;color:#74531f;&quot;&gt;Convert&lt;/span&gt;(1);
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Assert&lt;/span&gt;.&lt;span style=&quot;color:#74531f;&quot;&gt;Equal&lt;/span&gt;(&lt;span style=&quot;color:#a31515;&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;,&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;actual&lt;/span&gt;);
}&lt;/pre&gt;
    &lt;/p&gt;
    &lt;p&gt;
        Either the implementer is allowed to see the test, or the specification is communicated to him or her in some other way. In any case, the natural response to the first test is an implementation like this:
    &lt;/p&gt;
    &lt;p&gt;
        &lt;pre&gt;&lt;span style=&quot;color:blue;&quot;&gt;public&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;static&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;string&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#74531f;&quot;&gt;Convert&lt;/span&gt;(&lt;span style=&quot;color:blue;&quot;&gt;int&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;number&lt;/span&gt;)
{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;return&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#a31515;&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;;
}&lt;/pre&gt;
    &lt;/p&gt;
    &lt;p&gt;
        In TDD, this is expected. This is the simplest implementation that passes all tests. We imagine that the tester already knows this, and therefore adds this test next:
    &lt;/p&gt;
    &lt;p&gt;
        &lt;pre&gt;[&lt;span style=&quot;color:#2b91af;&quot;&gt;Fact&lt;/span&gt;]
&lt;span style=&quot;color:blue;&quot;&gt;public&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;void&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;Two&lt;/span&gt;()
{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;var&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;actual&lt;/span&gt;&amp;nbsp;=&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;FizzBuzzer&lt;/span&gt;.&lt;span style=&quot;color:#74531f;&quot;&gt;Convert&lt;/span&gt;(2);
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Assert&lt;/span&gt;.&lt;span style=&quot;color:#74531f;&quot;&gt;Equal&lt;/span&gt;(&lt;span style=&quot;color:#a31515;&quot;&gt;&amp;quot;2&amp;quot;&lt;/span&gt;,&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;actual&lt;/span&gt;);
}&lt;/pre&gt;
    &lt;/p&gt;
    &lt;p&gt;
        The implementer&apos;s response is this:
    &lt;/p&gt;
    &lt;p&gt;
        &lt;pre&gt;&lt;span style=&quot;color:blue;&quot;&gt;public&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;static&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;string&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#74531f;&quot;&gt;Convert&lt;/span&gt;(&lt;span style=&quot;color:blue;&quot;&gt;int&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;number&lt;/span&gt;)
{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;if&lt;/span&gt;&amp;nbsp;(&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;number&lt;/span&gt;&amp;nbsp;==&amp;nbsp;1)
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;return&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#a31515;&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;return&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#a31515;&quot;&gt;&amp;quot;2&amp;quot;&lt;/span&gt;;
}&lt;/pre&gt;
    &lt;/p&gt;
    &lt;p&gt;
        The tester can&apos;t see the implementation, so may believe that the implementation is now &apos;appropriate&apos;. Even if he or she wants to be &apos;more sure&apos;, a few more test cases (for, say, &lt;em&gt;4&lt;/em&gt;, &lt;em&gt;7&lt;/em&gt;, or &lt;em&gt;38&lt;/em&gt;) could be added; it doesn&apos;t make any difference for the following argument.
    &lt;/p&gt;
    &lt;p&gt;
        Next, incrementally, the tester may add a few test cases that cover the &lt;code&gt;&quot;Fizz&quot;&lt;/code&gt; behaviour:
    &lt;/p&gt;
    &lt;p&gt;
        &lt;pre&gt;[&lt;span style=&quot;color:#2b91af;&quot;&gt;Fact&lt;/span&gt;]
&lt;span style=&quot;color:blue;&quot;&gt;public&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;void&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;Three&lt;/span&gt;()
{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;var&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;actual&lt;/span&gt;&amp;nbsp;=&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;FizzBuzzer&lt;/span&gt;.&lt;span style=&quot;color:#74531f;&quot;&gt;Convert&lt;/span&gt;(3);
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Assert&lt;/span&gt;.&lt;span style=&quot;color:#74531f;&quot;&gt;Equal&lt;/span&gt;(&lt;span style=&quot;color:#a31515;&quot;&gt;&amp;quot;Fizz&amp;quot;&lt;/span&gt;,&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;actual&lt;/span&gt;);
}
 
[&lt;span style=&quot;color:#2b91af;&quot;&gt;Fact&lt;/span&gt;]
&lt;span style=&quot;color:blue;&quot;&gt;public&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;void&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;Six&lt;/span&gt;()
{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;var&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;actual&lt;/span&gt;&amp;nbsp;=&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;FizzBuzzer&lt;/span&gt;.&lt;span style=&quot;color:#74531f;&quot;&gt;Convert&lt;/span&gt;(6);
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Assert&lt;/span&gt;.&lt;span style=&quot;color:#74531f;&quot;&gt;Equal&lt;/span&gt;(&lt;span style=&quot;color:#a31515;&quot;&gt;&amp;quot;Fizz&amp;quot;&lt;/span&gt;,&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;actual&lt;/span&gt;);
}&lt;/pre&gt;
    &lt;/p&gt;
    &lt;p&gt;
        Similar test cases cover the &lt;code&gt;&quot;Buzz&quot;&lt;/code&gt; and &lt;code&gt;&quot;FizzBuzz&quot;&lt;/code&gt; behaviours. For this example, I wrote eight test cases in total, but a more sceptical tester might write twelve or even sixteen before feeling confident that the test suite sufficiently describes the desired behaviour of the system. Even so, a sufficiently adversarial implementer might (given eight test cases) deliver this implementation:
    &lt;/p&gt;
    &lt;p&gt;
        &lt;pre&gt;&lt;span style=&quot;color:blue;&quot;&gt;public&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;static&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;string&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#74531f;&quot;&gt;Convert&lt;/span&gt;(&lt;span style=&quot;color:blue;&quot;&gt;int&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;number&lt;/span&gt;)
{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;switch&lt;/span&gt;&amp;nbsp;(&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;number&lt;/span&gt;)
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;case&lt;/span&gt;&amp;nbsp;&amp;nbsp;1:&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;return&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#a31515;&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;case&lt;/span&gt;&amp;nbsp;&amp;nbsp;2:&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;return&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#a31515;&quot;&gt;&amp;quot;2&amp;quot;&lt;/span&gt;;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;case&lt;/span&gt;&amp;nbsp;&amp;nbsp;5:
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;case&lt;/span&gt;&amp;nbsp;10:&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;return&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#a31515;&quot;&gt;&amp;quot;Buzz&amp;quot;&lt;/span&gt;;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;case&lt;/span&gt;&amp;nbsp;15:
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;case&lt;/span&gt;&amp;nbsp;30:&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;return&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#a31515;&quot;&gt;&amp;quot;FizzBuzz&amp;quot;&lt;/span&gt;;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;default&lt;/span&gt;:&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;return&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#a31515;&quot;&gt;&amp;quot;Fizz&amp;quot;&lt;/span&gt;;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}
}&lt;/pre&gt;
    &lt;/p&gt;
    &lt;p&gt;
        To be clear, it&apos;s not that I expect real-world programmers to be either obtuse or nefarious. In real life, on the other hand, requirements are more complicated, and may be introduced piecemeal in a fashion that may lead to buggy, overly-complicated implementations.
    &lt;/p&gt;
    &lt;h3 id=&quot;8b7bb29424ea4c22a851aa98037cc43a&quot;&gt;
        Under-determination &lt;a href=&quot;#8b7bb29424ea4c22a851aa98037cc43a&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        Remarkably, black-box testing may work better as an ex-post technique, compared to TDD. If we imagine that an implementer has made an effort to correctly implement a system according to specification, a tester may use black-box testing to poke at the SUT, using both randomly selected test cases, and by explicitly exercising the SUT at boundary cases.
    &lt;/p&gt;
    &lt;p&gt;
        Even so, black-box testing in reality tends to run into the problem of &lt;a href=&quot;https://en.wikipedia.org/wiki/Underdetermination&quot;&gt;under-determination&lt;/a&gt;, also known from philosophy of science. As I outlined in &lt;a href=&quot;/2021/06/14/new-book-code-that-fits-in-your-head&quot;&gt;Code That Fits in Your Head&lt;/a&gt;, software testing has many similarities with empirical science. We use experiments (tests) to corroborate hypotheses that we have about software: Typically either that it &lt;em&gt;doesn&apos;t&lt;/em&gt; pass tests, or that it does pass all tests, depending on where in the red-green-refactor cycle we are.
    &lt;/p&gt;
    &lt;p&gt;
        Similar to science, we are faced with the basic epistemological problem that we have a finite number of tests, but usually an infinite (or at least extremely big) state space. Thus, as pointed out by the problem of under-determination, more than one &apos;reality&apos; fits the available observations (i.e. test cases). The above FizzBuzz implementation is an example of this.
    &lt;/p&gt;
    &lt;p&gt;
        As an aside, certain problems actually have &lt;a href=&quot;https://en.wikipedia.org/wiki/Image_(mathematics)&quot;&gt;images&lt;/a&gt; that are sufficiently small that you &lt;em&gt;can&lt;/em&gt; cover everything in total. In its most common description, the FizzBuzz kata, too, falls into this category.
    &lt;/p&gt;
    &lt;blockquote&gt;
        &lt;p&gt;
            &quot;Write a program that prints the numbers from &lt;em&gt;1 to 100&lt;/em&gt;.&quot;
        &lt;/p&gt;
        &lt;footer&gt;&lt;cite&gt;&lt;a href=&quot;https://codingdojo.org/kata/FizzBuzz/&quot;&gt;FizzBuzz&lt;/a&gt;&lt;/cite&gt;, my emphasis&lt;/footer&gt;
    &lt;/blockquote&gt;
    &lt;p&gt;
        This means that you &lt;em&gt;can&lt;/em&gt;, in fact, write 100 test cases and thereby specify the problem in its totality. What you still can&apos;t do with black-box testing, however, is impose a particular implementation. An adversarial implementer could write the &lt;code&gt;Convert&lt;/code&gt; function as one big &lt;code&gt;switch&lt;/code&gt; statement. Just like &lt;a href=&quot;/2021/03/29/table-driven-tennis-scoring&quot;&gt;I did with the Tennis kata&lt;/a&gt;, another &lt;a href=&quot;/2020/08/31/properties-for-all&quot;&gt;kata with a small state space&lt;/a&gt;.
    &lt;/p&gt;
    &lt;p&gt;
        This, however, rarely happens in the real world. Example-driven testing is under-determined. And no, &lt;a href=&quot;/2021/06/28/property-based-testing-is-not-the-same-as-partition-testing&quot;&gt;property-based testing doesn&apos;t fundamentally change that conclusion&lt;/a&gt;. It behoves you to &lt;em&gt;look&lt;/em&gt; critically at the actual implementation code, and not rely exclusively on testing.
    &lt;/p&gt;
    &lt;h3 id=&quot;83a20a3021d94138b5cbdd8f1dd2f71a&quot;&gt;
        Working with implementation code &lt;a href=&quot;#83a20a3021d94138b5cbdd8f1dd2f71a&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        It&apos;s hardly a surprise that TDD isn&apos;t black-box testing. Is it white-box testing, then? Since the red-green-refactor cycle dictates a tight loop between test and production code, you always have the implementation code at hand. In that sense, the SUT is a white box.
    &lt;/p&gt;
    &lt;p&gt;
        That said, the &lt;a href=&quot;https://en.wikipedia.org/wiki/White-box_testing&quot;&gt;common view on white-box testing&lt;/a&gt; is that you work with knowledge about the internal implementation of an &lt;em&gt;already-written&lt;/em&gt; system, and use that to design test cases. Typically, looking at the code should enable a tester to identify weak spots that warrant testing.
    &lt;/p&gt;
    &lt;p&gt;
        This isn&apos;t always the case with TDD. If you follow the red-green-refactor checklist, each cycle should leave you with a SUT that passes all tests in the simplest way that could possibly work. Consider the first incarnation of &lt;code&gt;Convert&lt;/code&gt;, above (the one that always returns &lt;code&gt;&quot;1&quot;&lt;/code&gt;). It passes all tests, and from a white-box-testing perspective, it has no weak spots. You can&apos;t identify a test case that&apos;ll make it crash.
    &lt;/p&gt;
    &lt;p&gt;
        If you consider the test suite as an executable specification, that degenerate implementation is &lt;em&gt;correct&lt;/em&gt;, since it passes all tests. Of course, according to the kata description, it&apos;s wrong. Looking at the SUT code will tell you that in a heartbeat. It should prompt you to add another test case. The question is, though, whether that qualifies as white-box testing, or it&apos;s rather reminiscent of the &lt;a href=&quot;https://blog.cleancoder.com/uncle-bob/2013/05/27/TheTransformationPriorityPremise.html&quot;&gt;transformation priority premise&lt;/a&gt;. Not that that&apos;s necessarily a dichotomy.
    &lt;/p&gt;
    &lt;h3 id=&quot;d3c56178d31c4c1fb25654a4a5e48243&quot;&gt;
        Overspecified software &lt;a href=&quot;#d3c56178d31c4c1fb25654a4a5e48243&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        Perhaps a more common problem with white-box testing in relation to TDD is the tendency to take a given implementation for granted. Of course, working according to the red-green-refactor cycle, there&apos;s no implementation before the test, but a common technique is to use &lt;a href=&quot;http://xunitpatterns.com/Mock%20Object.html&quot;&gt;Mock Objects&lt;/a&gt; to let tests specify how the SUT should be implemented. This leads to the familiar problem of &lt;a href=&quot;http://xunitpatterns.com/Fragile%20Test.html&quot;&gt;Overspecified Software&lt;/a&gt;.
    &lt;/p&gt;
    &lt;p&gt;
        Here&apos;s an example.
    &lt;/p&gt;
    &lt;h3 id=&quot;a26fc9b04a5f440aac256c6f19db26a8&quot;&gt;
        Finding values in an interval &lt;a href=&quot;#a26fc9b04a5f440aac256c6f19db26a8&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        In the code base that accompanies &lt;a href=&quot;/code-that-fits-in-your-head&quot;&gt;Code That Fits in Your Head&lt;/a&gt;, the code that handles a new restaurant reservation contains this code snippet:
    &lt;/p&gt;
    &lt;p&gt;
        &lt;pre&gt;&lt;span style=&quot;color:blue;&quot;&gt;var&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;reservations&lt;/span&gt;&amp;nbsp;=&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;await&lt;/span&gt;&amp;nbsp;Repository
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;ReadReservations&lt;/span&gt;(&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;restaurant&lt;/span&gt;.Id,&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;reservation&lt;/span&gt;.At)
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;ConfigureAwait&lt;/span&gt;(&lt;span style=&quot;color:blue;&quot;&gt;false&lt;/span&gt;);
&lt;span style=&quot;color:blue;&quot;&gt;var&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;now&lt;/span&gt;&amp;nbsp;=&amp;nbsp;Clock.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;GetCurrentDateTime&lt;/span&gt;();
&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;if&lt;/span&gt;&amp;nbsp;(!&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;restaurant&lt;/span&gt;.MaitreD.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;WillAccept&lt;/span&gt;(&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;now&lt;/span&gt;,&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;reservations&lt;/span&gt;,&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;reservation&lt;/span&gt;))
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;return&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#74531f;&quot;&gt;NoTables500InternalServerError&lt;/span&gt;();
 
&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;await&lt;/span&gt;&amp;nbsp;Repository.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;Create&lt;/span&gt;(&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;restaurant&lt;/span&gt;.Id,&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;reservation&lt;/span&gt;)
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;ConfigureAwait&lt;/span&gt;(&lt;span style=&quot;color:blue;&quot;&gt;false&lt;/span&gt;);&lt;/pre&gt;
    &lt;/p&gt;
    &lt;p&gt;
        The &lt;code&gt;ReadReservations&lt;/code&gt; method is of particular interest in this context. It turns out to be a small extension method on a more general interface method:
    &lt;/p&gt;
    &lt;p&gt;
        &lt;pre&gt;&lt;span style=&quot;color:blue;&quot;&gt;internal&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;static&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Task&lt;/span&gt;&amp;lt;&lt;span style=&quot;color:#2b91af;&quot;&gt;IReadOnlyCollection&lt;/span&gt;&amp;lt;&lt;span style=&quot;color:#2b91af;&quot;&gt;Reservation&lt;/span&gt;&amp;gt;&amp;gt;&amp;nbsp;&lt;span style=&quot;color:#74531f;&quot;&gt;ReadReservations&lt;/span&gt;(
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;this&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;IReservationsRepository&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;repository&lt;/span&gt;,
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;int&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;restaurantId&lt;/span&gt;,
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;DateTime&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;date&lt;/span&gt;)
{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;var&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;min&lt;/span&gt;&amp;nbsp;=&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;date&lt;/span&gt;.Date;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;var&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;max&lt;/span&gt;&amp;nbsp;=&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;min&lt;/span&gt;.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;AddDays&lt;/span&gt;(1).&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;AddTicks&lt;/span&gt;(-1);
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;return&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;repository&lt;/span&gt;.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;ReadReservations&lt;/span&gt;(&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;restaurantId&lt;/span&gt;,&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;min&lt;/span&gt;,&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;max&lt;/span&gt;);
}&lt;/pre&gt;
    &lt;/p&gt;
    &lt;p&gt;
        The &lt;code&gt;IReservationsRepository&lt;/code&gt; interface doesn&apos;t have a method that allows a client to search for all reservations on a given date. Rather, it defines a more general method that enables clients to search for reservations in a given interval:
    &lt;/p&gt;
    &lt;p&gt;
        &lt;pre&gt;&lt;span style=&quot;color:#2b91af;&quot;&gt;Task&lt;/span&gt;&amp;lt;&lt;span style=&quot;color:#2b91af;&quot;&gt;IReadOnlyCollection&lt;/span&gt;&amp;lt;&lt;span style=&quot;color:#2b91af;&quot;&gt;Reservation&lt;/span&gt;&amp;gt;&amp;gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;ReadReservations&lt;/span&gt;(
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;int&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;restaurantId&lt;/span&gt;,&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;DateTime&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;min&lt;/span&gt;,&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;DateTime&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;max&lt;/span&gt;);&lt;/pre&gt;
    &lt;/p&gt;
    &lt;p&gt;
        As the parameter names imply, the method finds and returns all the reservations for a given restaurant between the &lt;code&gt;min&lt;/code&gt; and &lt;code&gt;max&lt;/code&gt; values. &lt;a href=&quot;/2021/12/06/the-liskov-substitution-principle-as-a-profunctor&quot;&gt;A previous article&lt;/a&gt; already covers this method in much detail.
    &lt;/p&gt;
    &lt;p&gt;
        I think I&apos;ve stated this more than once before: Code is never perfect. Although I made a genuine attempt to write quality code for the book&apos;s examples, now that I revisit this API, I realize that there&apos;s room for improvement. The most obvious problem with that method definition is that it&apos;s not clear whether the range includes, or excludes, the boundary values. Would it improve encapsulation if the method instead took a &lt;a href=&quot;/2024/01/22/a-range-kata-implementation-in-c&quot;&gt;Range&amp;lt;DateTime&amp;gt;&lt;/a&gt; parameter?
    &lt;/p&gt;
    &lt;p&gt;
        At the very least, I could have named the parameters &lt;code&gt;inclusiveMin&lt;/code&gt; and &lt;code&gt;inclusiveMax&lt;/code&gt;. That&apos;s how the system is implemented, and you can see an artefact of that in the above extension method. It searches from midnight of &lt;code&gt;date&lt;/code&gt; to the tick just before midnight on the next day.
    &lt;/p&gt;
    &lt;p&gt;
        The SQL implementation reflects that contract, too.
    &lt;/p&gt;
    &lt;p&gt;
        &lt;pre&gt;&lt;span style=&quot;color:blue;&quot;&gt;SELECT&lt;/span&gt;&amp;nbsp;[PublicId]&lt;span style=&quot;color:gray;&quot;&gt;,&lt;/span&gt;&amp;nbsp;[At]&lt;span style=&quot;color:gray;&quot;&gt;,&lt;/span&gt;&amp;nbsp;[Name]&lt;span style=&quot;color:gray;&quot;&gt;,&lt;/span&gt;&amp;nbsp;[Email]&lt;span style=&quot;color:gray;&quot;&gt;,&lt;/span&gt;&amp;nbsp;[Quantity]
&lt;span style=&quot;color:blue;&quot;&gt;FROM&lt;/span&gt;&amp;nbsp;[dbo]&lt;span style=&quot;color:gray;&quot;&gt;.&lt;/span&gt;[Reservations]
&lt;span style=&quot;color:blue;&quot;&gt;WHERE&lt;/span&gt;&amp;nbsp;[RestaurantId]&amp;nbsp;&lt;span style=&quot;color:gray;&quot;&gt;=&lt;/span&gt;&amp;nbsp;@RestaurantId&amp;nbsp;&lt;span style=&quot;color:gray;&quot;&gt;AND&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;@Min&amp;nbsp;&lt;span style=&quot;color:gray;&quot;&gt;&amp;lt;=&lt;/span&gt;&amp;nbsp;[At]&amp;nbsp;&lt;span style=&quot;color:gray;&quot;&gt;AND&lt;/span&gt;&amp;nbsp;[At]&amp;nbsp;&lt;span style=&quot;color:gray;&quot;&gt;&amp;lt;=&lt;/span&gt;&amp;nbsp;@Max&lt;/pre&gt;
    &lt;/p&gt;
    &lt;p&gt;
        Here, &lt;code&gt;@RestaurantId&lt;/code&gt;, &lt;code&gt;@Min&lt;/code&gt;, and &lt;code&gt;@Max&lt;/code&gt; are query parameters. Notice that the query uses the &lt;code&gt;&amp;lt;=&lt;/code&gt; relation for both &lt;code&gt;@Min&lt;/code&gt; and &lt;code&gt;@Max&lt;/code&gt;, making both endpoints inclusive.
    &lt;/p&gt;
    &lt;h3 id=&quot;c3113935f001498681c7052959c30b2b&quot;&gt;
        Interactive white-box testing &lt;a href=&quot;#c3113935f001498681c7052959c30b2b&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        Since I&apos;m aware of the problem of overspecified software, I test-drove the entire code base using &lt;a href=&quot;/2019/02/18/from-interaction-based-to-state-based-testing&quot;&gt;state-based testing&lt;/a&gt;. Imagine, however, that I&apos;d instead used a dynamic mock library. If so, a test could have looked like this:
    &lt;/p&gt;
    &lt;p&gt;
        &lt;pre&gt;[&lt;span style=&quot;color:#2b91af;&quot;&gt;Fact&lt;/span&gt;]
&lt;span style=&quot;color:blue;&quot;&gt;public&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;async&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Task&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;PostUsingMoq&lt;/span&gt;()
{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;var&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;now&lt;/span&gt;&amp;nbsp;=&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;DateTime&lt;/span&gt;.Now;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;var&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;reservation&lt;/span&gt;&amp;nbsp;=
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Some&lt;/span&gt;.Reservation.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;WithDate&lt;/span&gt;(&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;now&lt;/span&gt;.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;AddDays&lt;/span&gt;(2).&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;At&lt;/span&gt;(20,&amp;nbsp;15));
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;var&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;repoTD&lt;/span&gt;&amp;nbsp;=&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;new&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Mock&lt;/span&gt;&amp;lt;&lt;span style=&quot;color:#2b91af;&quot;&gt;IReservationsRepository&lt;/span&gt;&amp;gt;();
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;repoTD&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;Setup&lt;/span&gt;(&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;r&lt;/span&gt;&amp;nbsp;=&amp;gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;r&lt;/span&gt;.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;ReadReservations&lt;/span&gt;(
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Some&lt;/span&gt;.Restaurant.Id,
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;reservation&lt;/span&gt;.At.Date,
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;reservation&lt;/span&gt;.At.Date.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;AddDays&lt;/span&gt;(1).&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;AddTicks&lt;/span&gt;(-1)))
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;ReturnsAsync&lt;/span&gt;(&lt;span style=&quot;color:blue;&quot;&gt;new&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Collection&lt;/span&gt;&amp;lt;&lt;span style=&quot;color:#2b91af;&quot;&gt;Reservation&lt;/span&gt;&amp;gt;());
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;var&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;sut&lt;/span&gt;&amp;nbsp;=&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;new&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;ReservationsController&lt;/span&gt;(
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;new&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;SystemClock&lt;/span&gt;(),
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;new&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;InMemoryRestaurantDatabase&lt;/span&gt;(&lt;span style=&quot;color:#2b91af;&quot;&gt;Some&lt;/span&gt;.Restaurant),
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;repoTD&lt;/span&gt;.Object);
 
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;var&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;ar&lt;/span&gt;&amp;nbsp;=&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;await&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;sut&lt;/span&gt;.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;Post&lt;/span&gt;(&lt;span style=&quot;color:#2b91af;&quot;&gt;Some&lt;/span&gt;.Restaurant.Id,&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;reservation&lt;/span&gt;.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;ToDto&lt;/span&gt;());
 
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Assert&lt;/span&gt;.&lt;span style=&quot;color:#74531f;&quot;&gt;IsAssignableFrom&lt;/span&gt;&amp;lt;&lt;span style=&quot;color:#2b91af;&quot;&gt;CreatedAtActionResult&lt;/span&gt;&amp;gt;(&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;ar&lt;/span&gt;);
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:green;&quot;&gt;//&amp;nbsp;More&amp;nbsp;assertions&amp;nbsp;could&amp;nbsp;go&amp;nbsp;here.&lt;/span&gt;
}&lt;/pre&gt;
    &lt;/p&gt;
    &lt;p&gt;
        This test uses &lt;a href=&quot;https://github.com/devlooped/moq&quot;&gt;Moq&lt;/a&gt;, but the example doesn&apos;t hinge on that. I rarely use dynamic mock libraries these days, but when I do, I still prefer Moq.
    &lt;/p&gt;
    &lt;p&gt;
        Notice how the &lt;code&gt;Setup&lt;/code&gt; reproduces the implementation of the &lt;code&gt;ReadReservations&lt;/code&gt; extension method. The implication is that if you change the implementation code, you break the test.
    &lt;/p&gt;
    &lt;p&gt;
        Even so, we may consider this an example of a test-driven white-box test. While, according to the red-green-refactor cycle, you&apos;re supposed to write the test before the implementation, this style of TDD only works if you, the test writer, has an exact plan for how the SUT is going to look.
    &lt;/p&gt;
    &lt;h3 id=&quot;7eda505b89c646c7a02b1726901b30b9&quot;&gt;
        An innocent refactoring? &lt;a href=&quot;#7eda505b89c646c7a02b1726901b30b9&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        Don&apos;t you find that &lt;code&gt;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;min&lt;/span&gt;.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;AddDays&lt;/span&gt;(1).&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;AddTicks&lt;/span&gt;(-1)&lt;/code&gt; expression a bit odd? Wouldn&apos;t the code be cleaner if you could avoid the &lt;code&gt;&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;AddTicks&lt;/span&gt;(-1)&lt;/code&gt; part?
    &lt;/p&gt;
    &lt;p&gt;
        Well, you can.
    &lt;/p&gt;
    &lt;p&gt;
        A &lt;em&gt;tick&lt;/em&gt; is the smallest unit of measurement of &lt;a href=&quot;https://learn.microsoft.com/dotnet/api/system.datetime&quot;&gt;DateTime&lt;/a&gt; values. Since ticks are discrete, the range defined by the extension method would be equivalent to a right-open interval, where the minimum value is still included, but the maximum is not. If you made that change, the extension method would be simpler:
    &lt;/p&gt;
    &lt;p&gt;
        &lt;pre&gt;&lt;span style=&quot;color:blue;&quot;&gt;internal&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;static&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Task&lt;/span&gt;&amp;lt;&lt;span style=&quot;color:#2b91af;&quot;&gt;IReadOnlyCollection&lt;/span&gt;&amp;lt;&lt;span style=&quot;color:#2b91af;&quot;&gt;Reservation&lt;/span&gt;&amp;gt;&amp;gt;&amp;nbsp;&lt;span style=&quot;color:#74531f;&quot;&gt;ReadReservations&lt;/span&gt;(
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;this&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;IReservationsRepository&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;repository&lt;/span&gt;,
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;int&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;restaurantId&lt;/span&gt;,
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;DateTime&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;date&lt;/span&gt;)
{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;var&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;min&lt;/span&gt;&amp;nbsp;=&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;date&lt;/span&gt;.Date;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;var&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;max&lt;/span&gt;&amp;nbsp;=&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;min&lt;/span&gt;.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;AddDays&lt;/span&gt;(1);
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;return&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;repository&lt;/span&gt;.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;ReadReservations&lt;/span&gt;(&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;restaurantId&lt;/span&gt;,&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;min&lt;/span&gt;,&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;max&lt;/span&gt;);
}&lt;/pre&gt;
    &lt;/p&gt;
    &lt;p&gt;
        In order to offset that change, you also change the SQL accordingly:
    &lt;/p&gt;
    &lt;p&gt;
        &lt;pre&gt;&lt;span style=&quot;color:blue;&quot;&gt;SELECT&lt;/span&gt;&amp;nbsp;[PublicId]&lt;span style=&quot;color:gray;&quot;&gt;,&lt;/span&gt;&amp;nbsp;[At]&lt;span style=&quot;color:gray;&quot;&gt;,&lt;/span&gt;&amp;nbsp;[Name]&lt;span style=&quot;color:gray;&quot;&gt;,&lt;/span&gt;&amp;nbsp;[Email]&lt;span style=&quot;color:gray;&quot;&gt;,&lt;/span&gt;&amp;nbsp;[Quantity]
&lt;span style=&quot;color:blue;&quot;&gt;FROM&lt;/span&gt;&amp;nbsp;[dbo]&lt;span style=&quot;color:gray;&quot;&gt;.&lt;/span&gt;[Reservations]
&lt;span style=&quot;color:blue;&quot;&gt;WHERE&lt;/span&gt;&amp;nbsp;[RestaurantId]&amp;nbsp;&lt;span style=&quot;color:gray;&quot;&gt;=&lt;/span&gt;&amp;nbsp;@RestaurantId&amp;nbsp;&lt;span style=&quot;color:gray;&quot;&gt;AND&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;@Min&amp;nbsp;&lt;span style=&quot;color:gray;&quot;&gt;&amp;lt;=&lt;/span&gt;&amp;nbsp;[At]&amp;nbsp;&lt;span style=&quot;color:gray;&quot;&gt;AND&lt;/span&gt;&amp;nbsp;[At]&amp;nbsp;&lt;span style=&quot;color:gray;&quot;&gt;&amp;lt;&lt;/span&gt;&amp;nbsp;@Max&lt;/pre&gt;
    &lt;/p&gt;
    &lt;p&gt;
        Notice that the query now compares &lt;code&gt;[At]&lt;/code&gt; with &lt;code&gt;@Max&lt;/code&gt; using the &lt;code&gt;&amp;lt;&lt;/code&gt; relation.
    &lt;/p&gt;
    &lt;p&gt;
        While this is formally a breaking change of the interface, it&apos;s entirely internal to the application code base. No external systems or libraries depend on &lt;code&gt;IReservationsRepository&lt;/code&gt;. Thus, this change is a true refactoring: It improves the code without changing the observable behaviour of the system.
    &lt;/p&gt;
    &lt;p&gt;
        Even so, this change breaks the &lt;code&gt;PostUsingMoq&lt;/code&gt; test.
    &lt;/p&gt;
    &lt;p&gt;
        To make the test pass, you&apos;ll need to repeat the change you made to the SUT:
    &lt;/p&gt;
    &lt;p&gt;
        &lt;pre&gt;[&lt;span style=&quot;color:#2b91af;&quot;&gt;Fact&lt;/span&gt;]
&lt;span style=&quot;color:blue;&quot;&gt;public&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;async&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Task&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;PostUsingMoq&lt;/span&gt;()
{
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;var&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;now&lt;/span&gt;&amp;nbsp;=&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;DateTime&lt;/span&gt;.Now;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;var&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;reservation&lt;/span&gt;&amp;nbsp;=
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Some&lt;/span&gt;.Reservation.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;WithDate&lt;/span&gt;(&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;now&lt;/span&gt;.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;AddDays&lt;/span&gt;(2).&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;At&lt;/span&gt;(20,&amp;nbsp;15));
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;var&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;repoTD&lt;/span&gt;&amp;nbsp;=&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;new&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Mock&lt;/span&gt;&amp;lt;&lt;span style=&quot;color:#2b91af;&quot;&gt;IReservationsRepository&lt;/span&gt;&amp;gt;();
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;repoTD&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;Setup&lt;/span&gt;(&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;r&lt;/span&gt;&amp;nbsp;=&amp;gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;r&lt;/span&gt;.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;ReadReservations&lt;/span&gt;(
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Some&lt;/span&gt;.Restaurant.Id,
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;reservation&lt;/span&gt;.At.Date,
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;reservation&lt;/span&gt;.At.Date.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;AddDays&lt;/span&gt;(1)))
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;ReturnsAsync&lt;/span&gt;(&lt;span style=&quot;color:blue;&quot;&gt;new&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Collection&lt;/span&gt;&amp;lt;&lt;span style=&quot;color:#2b91af;&quot;&gt;Reservation&lt;/span&gt;&amp;gt;());
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;var&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;sut&lt;/span&gt;&amp;nbsp;=&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;new&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;ReservationsController&lt;/span&gt;(
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;new&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;SystemClock&lt;/span&gt;(),
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;new&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;InMemoryRestaurantDatabase&lt;/span&gt;(&lt;span style=&quot;color:#2b91af;&quot;&gt;Some&lt;/span&gt;.Restaurant),
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;repoTD&lt;/span&gt;.Object);
 
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:blue;&quot;&gt;var&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;ar&lt;/span&gt;&amp;nbsp;=&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#8f08c4;&quot;&gt;await&lt;/span&gt;&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;sut&lt;/span&gt;.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;Post&lt;/span&gt;(&lt;span style=&quot;color:#2b91af;&quot;&gt;Some&lt;/span&gt;.Restaurant.Id,&amp;nbsp;&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;reservation&lt;/span&gt;.&lt;span style=&quot;font-weight:bold;color:#74531f;&quot;&gt;ToDto&lt;/span&gt;());
 
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:#2b91af;&quot;&gt;Assert&lt;/span&gt;.&lt;span style=&quot;color:#74531f;&quot;&gt;IsAssignableFrom&lt;/span&gt;&amp;lt;&lt;span style=&quot;color:#2b91af;&quot;&gt;CreatedAtActionResult&lt;/span&gt;&amp;gt;(&lt;span style=&quot;font-weight:bold;color:#1f377f;&quot;&gt;ar&lt;/span&gt;);
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span style=&quot;color:green;&quot;&gt;//&amp;nbsp;More&amp;nbsp;assertions&amp;nbsp;could&amp;nbsp;go&amp;nbsp;here.&lt;/span&gt;
}&lt;/pre&gt;
    &lt;/p&gt;
    &lt;p&gt;
        If it&apos;s only one test, you can probably live with that, but it&apos;s the opposite of a robust test; it&apos;s a &lt;a href=&quot;http://xunitpatterns.com/Fragile%20Test.html&quot;&gt;Fragile Test&lt;/a&gt;.
    &lt;/p&gt;
    &lt;blockquote&gt;
        &lt;p&gt;
            &quot;to refactor, the essential precondition is [...] solid tests&quot;
        &lt;/p&gt;
        &lt;footer&gt;&lt;cite&gt;&lt;a href=&quot;/ref/refactoring&quot;&gt;Refactoring&lt;/a&gt;, Martin Fowler, 1999&lt;/cite&gt;&lt;/footer&gt;
    &lt;/blockquote&gt;
    &lt;p&gt;
        A common problem with &lt;a href=&quot;/2019/02/25/an-example-of-interaction-based-testing-in-c&quot;&gt;interaction-based testing&lt;/a&gt; is that even small refactorings break many tests. We might see that as a symptom of having too much knowledge of implementation details. We might view this as related to white-box testing.
    &lt;/p&gt;
    &lt;p&gt;
        To be clear, the tests in the code base that accompanies &lt;a href=&quot;/code-that-fits-in-your-head&quot;&gt;Code That Fits in Your Head&lt;/a&gt; are all state-based, so contrary to the &lt;code&gt;PostUsingMoq&lt;/code&gt; test, all 161 tests easily survive the above refactoring.
    &lt;/p&gt;
    &lt;h3 id=&quot;b41f2409e6de4ae9abfc95b7ec40da21&quot;&gt;
        Greyscale-box TDD &lt;a href=&quot;#b41f2409e6de4ae9abfc95b7ec40da21&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        It&apos;s not too hard to argue that TDD isn&apos;t black-box testing, but it&apos;s harder to argue that it&apos;s not white-box testing. Naturally, as you follow the red-green-refactor cycle, you know all about the implementation. Still, the danger of being too aware of the SUT code is being trapped in an &lt;a href=&quot;/2024/12/09/implementation-and-usage-mindsets&quot;&gt;implementation mindset&lt;/a&gt;.
    &lt;/p&gt;
    &lt;p&gt;
        While there&apos;s nothing wrong with getting the implementation right, many maintainability problems originate in insufficient &lt;a href=&quot;/encapsulation-and-solid&quot;&gt;encapsulation&lt;/a&gt;. Deliberately treating the SUT as a grey box helps in discovering a SUT&apos;s contract. That&apos;s why I recommend techniques like &lt;a href=&quot;/2019/10/07/devils-advocate&quot;&gt;Devil&apos;s Advocate&lt;/a&gt;. Pretending to view the SUT from the outside can shed valuable light on usability and maintainability issues.
    &lt;/p&gt;
    &lt;h3 id=&quot;adbf81f39d8e44f7a56fc05623967245&quot;&gt;
        Conclusion &lt;a href=&quot;#adbf81f39d8e44f7a56fc05623967245&quot;&gt;#&lt;/a&gt;
    &lt;/h3&gt;
    &lt;p&gt;
        The notions of white-box and black-box testing have been around for decades. So has TDD. Even so, it&apos;s not always clear to practitioners whether TDD is one or the other. The reason is, I believe, that TDD is neither. Good TDD practice sits somewhere between white-box testing and black-box testing.
    &lt;/p&gt;
    &lt;p&gt;
        Exactly where on that greyscale spectrum TDD belongs depends on context. The more important encapsulation is, the closer you should move towards black-box testing. The more important correctness or algorithm performance is, the closer to white-box testing you should move.
    &lt;/p&gt;
    &lt;p&gt;
        You can, however, move position on the spectrum even in the same code base. Perhaps you want to start close to white-box testing as you focus on getting the implementation right. Once the SUT works as intended, you may then decide to shift your focus towards encapsulation, in which case moving closer to black-box testing could prove beneficial.
    &lt;/p&gt;
&lt;/div&gt;&lt;hr&gt;
      This blog is totally free, but if you like it, please consider &lt;a href="https://blog.ploeh.dk/support"&gt;supporting it&lt;/a&gt;.</description>
        <author>Mark Seemann</author>
        <guid isPermaLink="false">https://blog.ploeh.dk/2025/09/15/greyscale-box-test-driven-development</guid>
      </item>
    

  </channel>
</rss>
